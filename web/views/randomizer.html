{{
extend 'layout.html'
}}

<meta name="description" content="Solver for the randomized Super Metroid roms"/>
<link rel="shortcut icon" href={{=URL('static','favicon.ico')}} type="image/ico"/>
<script src="{{=URL('static','js/FileSaver.js')}}"></script>
<link rel="stylesheet" type="text/css" href={{=URL('static','css/mystyle_20191017.css')}} media="screen"/>

<link rel="stylesheet" type="text/css" href={{=URL('static','dist/switchery.css')}} media="screen"/>
<script src="{{=URL('static','dist/switchery.js')}}"></script>

<link href={{=URL('static', 'css/bootstrap-tour.min.css')}} rel="stylesheet">
<script src="{{=URL('static','js/bootstrap-tour.min.js')}}"></script>

<script type="text/javascript" src="{{=URL('static', '/highslide/highslide.js')}}"></script>
<link rel="stylesheet" type="text/css" href={{=URL("static", "/highslide/highslide.css")}} />
<script type="text/javascript">
hs.graphicsDir = "/solver/static/highslide/graphics/";
hs.showCredits = 0;
hs.zIndexCounter = 1000000;
hs.dimmingOpacity = 0.75;

if (hs.registerOverlay) {
        // The simple semitransparent close button overlay
        hs.registerOverlay({
                thumbnailId: 'areathumb',
                html: '<div class="closebutton"        onclick="return hs.close(this)" title="Close"></div>',
                position: 'top right',
                fade: 2 // fading the semi-transparent overlay looks bad in IE
        });
}
</script>

<script type="text/javascript" src="{{=URL('static', 'js/chosen.jquery.min.js')}}"></script>
<link rel="stylesheet" type="text/css" href={{=URL("static", "css/chosen.css")}} />

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<script type="text/javascript" src="{{=URL('static', 'js/jquery.redirect.js')}}"></script>

<script type="text/javascript" src="{{=URL('static', 'js/crc32.js')}}"></script>

<script type="text/javascript" src="{{=URL('static', 'js/localforage.nopromises.min.js')}}"></script>

<title>Super Metroid VARIA Randomizer</title>

<style>
.blankLastRow {
    height: 1em;
    background-color: #fff;
    border-bottom: none;
}
.customizerText {
    width: 40%;
    margin-left: 30%;
    margin-right: 30%;
    margin-top: 1em;
    margin-bottom: 0em;
    text-align: center;
}
.donate {
    text-align: center;
    margin-top: 1em;
}
.rightStep {
    float: right;
    margin-right: 0.3em;
}
.top {
    vertical-align: top;
}
.parent-center {
    text-align: center;
}
.child-center {
    margin: auto;
}
.popover {
    max-width: 40%;
}
.highslide-dimming {
    background: black;
}
#overlay {
    position: fixed; /* Sit on top of the page content */
    display: none; /* Hidden by default */
    width: 100%; /* Full width (cover the whole page) */
    height: 100%; /* Full height (cover the whole page) */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0,0,0,0.5); /* Black background with opacity */
    z-index: 2; /* Specify a stack order in case you're using a different order for other elements */
    cursor: pointer; /* Add a pointer on hover */
}
#loadingGIF {
    position: absolute;
    left: 5%;
    z-index: 3;
    display:none;
}
@media (max-height: 800px) {
    .loadingGIF {
         top: 20%;
    }
}
@media (min-height: 800px) {
    .loadingGIF {
         top: 40%;
    }
}
.loadingTips {
    position: fixed;
    left: 50%;
    bottom: 10%;
    z-index: 99;
    display:none;
    border-radius: 2em;
    background-color: #ffffff;
    height: auto;
    padding: 0.5%;
    border: 2px solid #666666;
}
.sixty {
    width: 65%
}
.thirty {
    width: 30%
}
.floatright {
    float: right;
    vertical-align: top;
    margin-top: -0.3em;
}
.floatleft {
    float: left;
    vertical-align: top;
}
#slider-container {
  width: 80%;
  height: 80px;
  box-sizing: border-box;
  position: relative;
  top: 50%;
  margin: 0 auto;
  text-align: center;
  background: #FFF;
  padding: 35px 40px 30px 40px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.ui-slider, .ui-slider .slider-range-inverse, .ui-slider .ui-slider-range {
  height: 14px;
  border-radius: 0px;
  border-width: 0;
}
.ui-slider {
  background-color: #1ABC9C;
  background-image: linear-gradient(to right, #0000e8 0%, #e80074 25%, #e8e800 50%, #00e874 75%, #0000e8 100%);
}
.ui-slider * {
  outline: none;
}
.ui-slider .slider-range-inverse0 {
  background: #CCC;
  position: absolute;
  left: 0;
  height: 12px;
}
.ui-slider .slider-range-inverse1 {
  background: #CCC;
  position: absolute;
  right: 0;
  height: 12px;
}
.ui-slider .ui-slider-range {
  background: transparent;
}
.ui-slider .ui-slider-handle {
  width: 6px;
  height: 20px;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
  background: #FFF;
  top: -4px;
  border-width: 0;
  margin-left: -3px;
}
.ui-slider .ui-slider-handle:active {
  box-shadow: 0 3px 20px rgba(0, 0, 0, 0.5);
}
.ui-slider .ui-slider-handle .dot {
  width: 4px;
  height: 18px;
  position: absolute;
  top: 1px;
  left: 1px;
  background: transparent;
  overflow: hidden;
}
.ui-slider .ui-slider-handle .dot .handle-track0 {
  display: block;
  height: 18px;
  background-color: #1ABC9C;
  background-image: linear-gradient(to right, #0000e8 0%, #e80074 25%, #e8e800 50%, #00e874 75%, #0000e8 100%);
  position: absolute;
  margin-left: 0px;
}
.ui-slider .ui-slider-handle .dot .handle-track1 {
  display: block;
  height: 18px;
  background-color: #1ABC9C;
  background-image: linear-gradient(to right, #0000e8 0%, #e80074 25%, #e8e800 50%, #00e874 75%, #0000e8 100%);
  position: absolute;
  margin-left: 8px;
}

.sixty {
    width: 65%
}
.thirty {
    width: 30%
}
.floatright {
    float: right;
    /* vertical-align: top; */
    margin-top: -1em;
}
.floatleft {
    float: left;
    /* vertical-align: top; */
    margin-right: 0.5em;
}
.sixth {
    witdh: 16.66%;
}
.paddingonleft {
    padding-left: 2em;
}
.centerIcon {
    display: block;
    margin-left: auto;
    margin-right: 1em;
    width: 32px;
    image-rendering: -moz-crisp-edges; /* Firefox */
    image-rendering: -o-crisp-edges; /* Opera */
    image-rendering: -webkit-optimize-contrast; /* Webkit (non-standard naming) */
    image-rendering: crisp-edges;
    -ms-interpolation-mode: nearest-neighbor; /* IE (non-standard property) */
}
.marginRight {
    margin-right: 2em;
}
.center_img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 40%;
}
</style>

<script type="text/javascript">
// https://stackoverflow.com/questions/16960690/chosen-harvesthq-resize-width-dynamically
$(document).ready(function(){
   jQuery(window).on('resize', resizeChosen);
});

// chosen elements need a special method to update their value
var chosenElements = ["preset", "startLocationMultiSelect", "majorsSplitMultiSelect", "progressionSpeedMultiSelect", "progressionDifficultyMultiSelect", "morphPlacementMultiSelect", "energyQtyMultiSelect"];
var currentMultiValues = {{response.write(currentMultiValues, escape=False)}};
var defaultMultiValues = {{response.write(defaultMultiValues, escape=False)}};

function resizeChosen() {
   $(".chosen-container").each(function() {
       $(this).attr('style', 'width: 100%');
   });
}

function isElemRandom(elem) {
    return elem.className.search("active") != -1;
}

function isElemIdRandom(elemId) {
    return isElemRandom(document.getElementById(elemId+"Random"));
}

function randomize(evt, elemId) {
  var e = document.getElementById(elemId);

  var isActive;
  if(isElemRandom(evt.currentTarget)) {
    evt.currentTarget.className = evt.currentTarget.className.replace(" active", "");
    isActive = false;

    defaultValues = {"missileQty": 3, "superQty": 2, "powerBombQty": 1, "minorQty": 100};

    if(e.value.length == 0 && elemId in defaultValues) {
      e.value = defaultValues[elemId];
    }

  } else {
    evt.currentTarget.className += " active";
    isActive = true;
  }

  disableElement(elemId, isActive);

  // disable elements on the same line
  var additionnal = {"areaRandomization": ["areaLayout", "lightAreaRandomization"],
                     "escapeRando": ["removeEscapeEnemies"]};
  if(elemId in additionnal) {
      for(var i=0; i<additionnal[elemId].length; i++) {
          disableElement(additionnal[elemId][i], isActive);
      }
  }

  // special case for multi select
  var multi = document.getElementById(elemId+"MultiSelectDiv");
  if(multi != null) {
    if(isActive == true) {
      e.style.display = "none";
      multi.style.display = "block";
      // chosen must be activated when it's visible, else it doesn't work...
      $("#"+elemId+"MultiSelect").chosen();
    } else {
      e.style.display = "block";
      multi.style.display = "none";
    }
  }
}

function randomizeMinimizer(evt) {
  // randomizer the number of locations between 30 and 60.
  // click on random dice: click on miminizer if not already active
  var minimizer = document.getElementById("minimizer");
  var elemId = "minimizerQty"
  var e = document.getElementById(elemId);

  var isActive;
  if(isElemRandom(evt.currentTarget)) {
    evt.currentTarget.className = evt.currentTarget.className.replace(" active", "");
    e.value = 45;
    if(minimizer.checked) {
      disableElement(elemId, false);
    }
  } else {
    if(! minimizer.checked) { minimizer.click(); }
    evt.currentTarget.className += " active";
    disableElement(elemId, true);
  }
}

function disableElement(id, disable) {
  var elem = document.getElementById(id);
  elem.disabled = disable;
  // grey out the disabled text
  var text = document.getElementById(id+"Text");
  if(elem.disabled) {
      text.className = "disabledText";
  } else {
      text.className = "";
  }
  // tell switchery
  if(id in globalSwitchs) {
    var sw = globalSwitchs[id];
    if(disable) {
      sw.disable();
    } else {
      sw.enable();
    }
  }
}

function getComplexity() {
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    if(tablinks[i].className.includes("active")) {
      return tablinks[i].id;
    }
  }
}

function setRandom() {
{{
    for id in ["missileQty", "superQty", "powerBombQty", "minorQty", "energyQty", "majorsSplit", "suitsRestriction", "morphPlacement", "funCombat", "funMovement", "funSuits", "progressionDifficulty", "hideItems", "strictMinors", "progressionSpeed", "areaRandomization", "doorsColorsRando", "bossRandomization", "escapeRando", "startLocation", "minimizerQty"]:
      if id in session.randomizer and session.randomizer[id] == "random":
        response.write("  document.getElementById(\"{}Random\").click();\n".format(id), escape=False)
        if "{}MultiSelect".format(id) in session.randomizer:
          response.write("  $(\"#{}MultiSelect\").val({});\n".format(id, session.randomizer["{}MultiSelect".format(id)]), escape=False)
          pass
        pass
      pass
}}
}

function setComplexity() {
{{
  if "complexity" in session.randomizer:
    response.write('  document.getElementById("{}").click();'.format(session.randomizer["complexity"]), escape=False)
  else:
    response.write('  document.getElementById("simple").click();', escape=False)
    pass
}}
}

function changeComplexity(evt, name) {
  if(name == "simple") {
    var show = ["noPatchesVisibility"];
    var hide = ["seedVisibility", "ammoVisibility", "maxDiffVisibility", "progDiffVisibility", "suitsRestrictionVisibility", "morphPlacementVisibility", "superFunVisibility", "patchesVisibility", "hideItemsVisibility", "raceModeVisibility", "escapeRandoVisibility", "helperPatchesVisibility", "areaLayoutVisibility"];
    showHide(show, hide);
  }

  else if(name == "medium") {
    var show = ["maxDiffVisibility", "patchesVisibility", "morphPlacementVisibility", "ammoVisibility", "nerfedChargeVisibility", "musicVisibility", "escapeRandoVisibility"];
    var hide = ["seedVisibility", "progDiffVisibility", "suitsRestrictionVisibility", "strictMinorsVisibility", "missileQtyVisibility", "superQtyVisibility", "powerBombQtyVisibility", "superFunVisibility", "mainPatchesVisibility", "gravityBehaviourVisibility", "mainPatchesTextVisibility", "hideItemsVisibility", "raceModeVisibility", "miscVisibility", "helperPatchesVisibility", "areaLayoutVisibility", "noPatchesVisibility"];
    showHide(show, hide);
  }

  else {
    var show = ["seedVisibility", "ammoVisibility", "maxDiffVisibility", "progDiffVisibility", "suitsRestrictionVisibility", "morphPlacementVisibility", "strictMinorsVisibility", "missileQtyVisibility", "superQtyVisibility", "powerBombQtyVisibility", "superFunVisibility", "patchesVisibility", "mainPatchesVisibility", "gravityBehaviourVisibility", "mainPatchesTextVisibility", "hideItemsVisibility", "raceModeVisibility", "nerfedChargeVisibility", "miscVisibility", "musicVisibility", "escapeRandoVisibility", "helperPatchesVisibility", "areaLayoutVisibility"];
    var hide = ["noPatchesVisibility"];
    showHide(show, hide);
  }

  // set current button to active
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
  }

  evt.currentTarget.className += " active";
}

function showHide(show, hide) {
  for(var i=0; i<show.length; i++) {
    var showId = show[i];
    var elem = document.getElementById(showId);
    elem.classList.remove("hidden");
  }
  for(var i=0; i<hide.length; i++) {
    var hideId = hide[i];
    var elem = document.getElementById(hideId);
    elem.classList.add("hidden");
  }
}

var globalSwitchs = {};

function AjaxPresetCallCompleted(data) {
    console.log("AjaxPresetCallCompleted");

    var dataDict = {paramsFileTarget : data, "complexity": getComplexity()};
    var elems = ["seed", "preset", "raceMode", "areaLayout", "lightAreaRandomization", "removeEscapeEnemies", "layoutPatches", "variaTweaks", "gravityBehaviour", "nerfedCharge", "itemsounds", "elevators_doors_speed", "spinjumprestart", "rando_speed", "animals", "No_Music", "random_music", "maxDifficulty", "Infinite_Space_Jump", "refill_before_save", "minimizer", "minimizerTourian", "allowGreyDoors"];
    var randomElems = ["missileQty", "superQty", "powerBombQty", "minorQty", "suitsRestriction", "funCombat", "funMovement", "funSuits", "hideItems", "strictMinors", "areaRandomization", "doorsColorsRando", "bossRandomization", "escapeRando", "minimizerQty"];
    var multiElems = ["majorsSplit", "startLocation", "energyQty", "morphPlacement", "progressionDifficulty", "progressionSpeed"];

    for(var i=0; i<elems.length; i++) {
        // if element is disabled set it to off
        var elem = document.getElementById(elems[i]);
        if(elem.disabled == true) {
            dataDict[elems[i]] = "off";
        } else {
            dataDict[elems[i]] = elem.value;
        }
    }
    for(var i=0; i<randomElems.length; i++) {
       // check if random dice is checked
       if(isElemIdRandom(randomElems[i])) {
         dataDict[randomElems[i]] = "random";
       } else {
         dataDict[randomElems[i]] = document.getElementById(randomElems[i]).value;
       }
    }
    for(var i=0; i<multiElems.length; i++) {
       // check if random dice is checked
       var elemId = multiElems[i];
       if(isElemIdRandom(elemId)) {
         dataDict[elemId] = "random";
         multiElemId = elemId+"MultiSelect";
         dataDict[multiElemId] = $("#"+multiElemId).val().join();
       } else {
         dataDict[elemId] = document.getElementById(elemId).value;
       }
    }

    // call web service with parameters
    var request = $.ajax({
      url: "{{=URL(f='randomizerWebService')}}",
      method: "POST",
      data: dataDict,
      dataType: "json",
      crossDomain: true
    });

    request.done(AjaxRandomizerCallCompleted);
    request.fail(ajaxFailJSON);
}

function ajaxFail(jqXHR, textStatus) {
  document.getElementById("flash").innerHTML = jqXHR.responseText;
  $('#flash').show();
  $('#overlay').hide();
  $('#loadingGIF').hide();
  cancelTip();
}

function ajaxFailJSON(jqXHR, textStatus) {
  // cross domain calls currently return 'undefined' information... (cf. https://www.html5rocks.com/en/tutorials/cors/)
  if(jqXHR.responseJSON == null) {
    document.getElementById("flash").innerHTML = "Something wrong happened or the VARIA randomizer aborted: please try again. If this happens again after retrying, raise or disable max difficulty setting, and/or disable Super Fun Times (TM) setting. If Area Randomization was selected, try to enable Full Randomization as well.";
  } else {
    document.getElementById("flash").innerHTML = jqXHR.responseJSON;
  }
  $('#flash').show();
  $('#overlay').hide();
  $('#loadingGIF').hide();
  cancelTip();
}

function unpack_3bytes(ips, i) {
  var b1 = ips[i];
  var b2 = ips[i+1];
  var b3 = ips[i+2];
  return (b1*65536) + (b2*256) + b3;
}

function unpack_2bytes(ips, i) {
  var b1 = ips[i];
  var b2 = ips[i+1];
  return (b1*256) + b2;
}

function AjaxRandomizerCallCompleted(data) {
    console.log("AjaxRandomizerCallCompleted");

    // with items/Locations patch the local rom in memory
    // always make a copy to avoid modifying vanilla rom buffer from local storage
    var bytes_temp = new Uint8Array(vanillaROM);
    var bytes = new Uint8Array(bytes_temp.length);
    bytes.set(bytes_temp);

    var binary_string = atob(data["ips"]);
    var len = binary_string.length;
    var ips = new Uint8Array(len);
    for(var i = 0; i < len; i++) {
        ips[i] = binary_string.charCodeAt(i);
    }

    console.log("IPS size: "+ips.length);
    var i = 5;
    var offset = 0;
    var size = 0;
    var rle_size = 0;

    while(i < ips.length - 3) {
        offset = unpack_3bytes(ips, i);
        i += 3;
        size = unpack_2bytes(ips, i);
        i += 2;

        if(size == 0) {
            // RLE
            rle_size = unpack_2bytes(ips, i);
            i += 2;
            for(j=0; j<rle_size; j++) {
                bytes[offset+j] = ips[i];
            }
            i += 1;
        } else {
            for(j=0; j<size; j++) {
                bytes[offset+j] = ips[i+j];
            }
            i += j;
        }
    }

    // fix checksum
    var sum1 = 0;
    for(var i=0; i<0x200000; i++) { sum1 += bytes[i]; }
    var sum2 = 0;
    for(var i=0x200000; i<0x300000; i++) { sum2 += bytes[i]; }
    var sum = (sum1 + (sum2 * 2)) & 0xFFFF;
    var sumlo = sum & 0x00FF;
    var sumhi = (sum & 0xFF00) >> 8;
    var invSum = sum ^ 0xFFFF;
    var invSumlo = invSum & 0x00FF;
    var invSumhi = (invSum & 0xFF00) >> 8;
    bytes[0x7FDC] = invSumlo;
    bytes[0x7FDD] = invSumhi;
    bytes[0x7FDE] = sumlo;
    bytes[0x7FDF] = sumhi;

    var blob = new Blob([bytes], {type: "octet/stream"});

    var outFileName = data['fileName'];
    saveAs(blob, outFileName);

    // add permalink
    if('seedKey' in data) {
        var host = window.location.protocol+"//"+window.location.hostname;
        if(window.location.port.length > 0) {
            host = host+":"+window.location.port;
        }
        var seedKey = data['seedKey'];
        var link = encodeURI(host+"/customizer/"+seedKey);
        document.getElementById("permalink").innerHTML = "<a href=\""+link+"\" target=\"_blank\">"+link+"</a>";
    }

    // info message to display ?
    if("errorMsg" in data && data["errorMsg"].length > 0) {
        document.getElementById("flash").innerHTML = data["errorMsg"];
        $('#flash').show();
        displayFlash = true;
    } else {
        displayFlash = false;
    }

    // set backup button text to Randomize
    document.getElementById("submitBtn").data = "Randomize";

    var dataDict = {"complexity": getComplexity()};
    var elems = ["seed", "preset", "raceMode", "areaLayout", "lightAreaRandomization", "removeEscapeEnemies", "layoutPatches", "variaTweaks", "gravityBehaviour", "nerfedCharge", "itemsounds", "elevators_doors_speed", "spinjumprestart", "rando_speed", "animals", "No_Music", "randoPreset", "random_music", "maxDifficulty", "Infinite_Space_Jump", "refill_before_save", "minimizer", "minimizerTourian", "allowGreyDoors"];
    var randomElems = ["missileQty", "superQty", "powerBombQty", "minorQty", "suitsRestriction", "funCombat", "funMovement", "funSuits", "hideItems", "strictMinors", "areaRandomization", "doorsColorsRando", "bossRandomization", "escapeRando", "minimizerQty"];
    var multiElems = ["majorsSplit", "startLocation","energyQty", "morphPlacement", "progressionDifficulty", "progressionSpeed"];

    for(var i=0; i<elems.length; i++) {
       dataDict[elems[i]] = document.getElementById(elems[i]).value;
    }
    for(var i=0; i<randomElems.length; i++) {
       // check if random dice is checked
       if(isElemIdRandom(randomElems[i])) {
         dataDict[randomElems[i]] = "random";
       } else {
         dataDict[randomElems[i]] = document.getElementById(randomElems[i]).value;
       }
    }
    for(var i=0; i<multiElems.length; i++) {
       // check if random dice is checked
       var elemId = multiElems[i];
       if(isElemIdRandom(elemId)) {
         dataDict[elemId] = "random";
         multiElemId = elemId+"MultiSelect";
         dataDict[multiElemId] = $("#"+multiElemId).val().join();
       } else {
         dataDict[elemId] = document.getElementById(elemId).value;
       }
    }

    // call webservice to update the session
    var request = $.ajax({
      url: "{{=URL(f='sessionWebService')}}",
      method: "POST",
      data: dataDict,
      dataType: "html"
    });

    request.fail(ajaxFail);

    // remove "working" message
    if(displayFlash == false){
        $('#flash').hide();
    }
    $('#overlay').hide();
    $('#loadingGIF').hide();
    cancelTip();
}

function doSubmit() {
  if(window.File && window.FileList && window.FileReader) {

    if(vanillaROMStored == false) {
        alert("Please select a Super Metroid Vanilla ROM first");
        return false;
    }

    var dataDict = {"preset": document.getElementById("preset").value};

    // call preset web service with parameters
    var request = $.ajax({
      url: "{{=URL(f='presetWebService')}}",
      method: "POST",
      data: dataDict,
      dataType: "html"
    });

    request.done(AjaxPresetCallCompleted);
    request.fail(ajaxFail);

    // while WS is working, display "working" message
    $('#overlay').show();
    $('#loadingGIF').show();
    loadTip();
  }

  return false;
}

function getRndInteger(max) {
  return Math.floor(Math.random() * max );
}

var tips = [
    "You can display the logic details for a skill preset by loading it on the Presets page",
    "With VARIA tweaks on (default) you can activate Lower Norfair Chozo (left of entrance) without Space Jump",
    "With VARIA tweaks on (default) you can access item at Wrecked Ship Etank location without killing Phantoon (via Forgotten Highway)",
    "By default Gravity Suit environmental protection (heat, spikes, electricity...) is removed, it balances more the two suits abilities",
    "Creating your own skills preset will lead to a better experience overall, as the generated ROMs will be tailored for you",
    "The skills preset is used by the Randomizer, Solver, Tracker and Plandomizer to know which techniques are available to reach the item locations",
    "Majors split Chozo: Put all the upgrades as well as minimal ammo/energy to finish the seed in the Chozo locations",
    "Majors split Full: All items are shuffled in all locations",
    "Majors split Majors/Minors: Use major (upgrades and energy) and minor (ammo) item pools",
    "Majors split Majors/Minors: High-Jump boots Energy Tank location is considered minor, and right Super Missile in Wrecked ship is considered major for balancing purposes",
    "Progression speed setting will have a big impact on seed difficulty. The slower the speed is, the harder the seed will be (usually)",
    "VARIAble progression speed will randomly change internal progression speed while placing items, creating seeds that are more unpredictable",
    "speedrun progression speed is less item hunt oriented, and is well suited for racing",
    "Progression difficulty setting will have a moderate impact on seed difficulty compared to progression speed",
    "Late Morph is best suited when used along area randomization, to find Morph in peculiar places",
    "For the Late morph setting to work at full power, you must enable Area+Full randomization, and leave Suits Restriction off. If the seed generation fails, just retry.",
    "The Tracker can be use in seedless mode, aka I use my tablet on my couch. Just click 'Init' without picking a seed file",
    "If you're stuck while playing a seed, use the Solver or the Tracker to know where to go next",
    "All generated seeds are MSU-1 compatible",
    "Anti soft-lock layout modification are applied by default",
    "You can use the tracker to track the connections between the areas and avoid getting too lost in area rando",
    "With Boss randomization, the areas or rooms unlocked by the bosses stay unchanged. For example, you still have to kill Phantoon to activate Wrecked Ship.",
    "The aim buttons can be assigned to any button",
    "You can save your own button layout as well as moonwalk option in your skills preset to avoid doing the setup every seed",
    "Using a non-standard or randomized start location will enable Full randomization, all anti-softlock patches and VARIA tweaks",
    "All starting locations come with their layout changes or doors opened, be sure to check them by clicking on '?' next to the option",
    "During randomized escape sequence, your hyper beam can destroy super/bomb/PB blocks, and open all gates",
    "During randomized escape sequence, if you 'forgot' to pick up a suit during your run and cannot escape, you can reload and exit Tourian at any time",
    "During randomized escape sequence, you can find the animals behind a map station door or/and try different escape by going to vanilla animals",
    "Click on the '?' buttons to get help and tutorials in all pages of the VARIA site",
    "You can alter the Suits behaviour in the Advanced tab (Patches section). Choose between Balanced (default), Progressive (like DASH randomizer), and Vanilla.",
    "Tired of looking for Charge beam? Check out the 'Nerfed Charge' patch accessible in Medium and Advanced tabs",
    "Super Fun settings (Advanced tab) do not require any specific skill in your preset. The seeds generated will always be completable.",
    "Check out the Plandository to play plandos published VARIA users, as well as VARIA weekly races seeds/plandos",
    "If you're new to area rando, or don't want to use the tracker, try out Light Area Randomization",
    "In Light Area rando, vanilla area transitions are preserved, only their place is changed",
    "In for a quick play? Try out Boss Rush/Minimizer mode. Load 'minimizer' settings preset to easily set it up",
    "In Minimizer mode, areas and bosses transition are mixed together, and you can make the map as big as you want between 30 and 100 locations",
    "With Doors Colors randomization, all 3 ammo types and all 4 beams (not counting Charge) are distinct keys for locked colored doors",
    "With Doors Colors and/or Areas Randomization, rolling backup saves are enabled. You can safely save in two different save stations even if unsure you can come back."
];

var myTimer = null;
var curLoadingTips = 0;

function loadTip(first = true) {
    if(first == true) {
      curLoadingTips = 0;
    } else {
      // first fadeout the current one
      var elem = "loadingTips" + curLoadingTips;
      $("#"+elem).fadeOut(1000);
      curLoadingTips = 1 - curLoadingTips;
    }

    var tip = tips[getRndInteger(tips.length)];
    var elem = "loadingTips" + curLoadingTips;
    document.getElementById(elem).innerHTML = tip;
    document.getElementById(elem).style.marginLeft = "-" + tip.length/4 + "em";
    $("#"+elem).fadeIn(1000);
    myTimer = setTimeout(loadTip, 5000, false);
}

function cancelTip() {
  if(myTimer != null) {
    clearTimeout(myTimer);
    myTimer = null;
  }
  $("#loadingTips"+curLoadingTips).fadeOut(3000);
  curLoadingTips = 1 - curLoadingTips;
  $("#loadingTips"+curLoadingTips).hide();
}

var vanillaROMStored = false;
var vanillaROM = null;
window.onload = function(){
    //Check File API support
    if(window.File && window.FileList && window.FileReader) {
        var filesInput = document.getElementById("uploadFile");
        filesInput.addEventListener("change", function(event){
            var files = event.target.files; //It returns a FileList object
            var file = files[0];

            var crc32 = new Crc32();

            var reader = new FileReader();
            reader.readAsArrayBuffer(file)
            reader.onload = function(e) {
                // check sfc or smc extention
                var re = /(?:\.([^.]+))?$/;
                var ext = re.exec(file.name)[1];
                console.log("ext: "+ext)
                if( ! (ext === "sfc" || ext === "smc" || ext === "SFC" || ext === "SMC") ) {
                    document.getElementById("uploadFile").value = "";
                    alert("wrong extension: "+ext);
                    return false;
                }

                var fileSize = file.size;
                if( fileSize > 4*1024*1024 ) {
                    document.getElementById("uploadFile").value = "";
                    alert("wrong ROM file size: "+fileSize.toString());
                    return false;
                } else if( fileSize == 3146240) {
                    document.getElementById("uploadFile").value = "";
                    alert("headered ROM detected, please use an unheadered ROM");
                    return false;
                }

                crc32.update(e.target.result);
                var digest = crc32.digest();
                console.log("crc32: "+digest);
                if(digest != "d63ed5f8") {
                    document.getElementById("uploadFile").value = "";
                    alert("Non vanilla ROM detected");
                    return false;
                }

                // store file in localforage
                localforage.setItem('vanillaROM', e.target.result, function(err, value) {
                    if(err != null) {
                        clearLocalStorage();
                    } else {
                        console.log("vanilla ROM stored in local storage");
                        vanillaROM = value;
                        vanillaROMStored = true;
                        displayROMInput(false);
                    }
                });
            }
        }, false);
    } else {
        alert("This website requires the HTML5 File API, please upgrade your browser to a newer version.");
    }

    var area = document.getElementById("areaRandomization");
    area.onchange = function(){
        var area = document.getElementById("areaRandomization");
        var patches = document.getElementById("areaLayout");
        var lateMorph = document.getElementById("morphPlacement");
        var suits = document.getElementById("suitsRestriction");
        var escapeRando = document.getElementById("escapeRando");

        if(area.checked){
            disableElement("areaLayout", false);
            disableElement("lightAreaRandomization", false);

            if(! patches.checked){ patches.click(); }
            if(! escapeRando.checked){ escapeRando.click(); }

            // uncheck suits restrictions when late morph + area
            if(lateMorph.options[lateMorph.selectedIndex].text == "late"){
                if(suits.checked){
                    suits.click();
                }
            }
        } else {
            if(patches.checked){ patches.click(); }
            if(escapeRando.checked){ escapeRando.click(); }
            var lightAreaRandomization = document.getElementById("lightAreaRandomization");
            if(lightAreaRandomization.checked){ lightAreaRandomization.click(); }
            var minimizer = document.getElementById("minimizer");
            if(minimizer.checked){ minimizer.click(); }

            disableElement("areaLayout", true);
            disableElement("lightAreaRandomization", true);
        }
        switchCheckbox("areaRandomization");
    };
    if(! area.checked){
        disableElement("areaLayout", true);
        disableElement("lightAreaRandomization", true);
    }

    var boss = document.getElementById("bossRandomization");
    boss.onchange = function(){
        if(! boss.checked){
            var minimizer = document.getElementById("minimizer");
            if(minimizer.checked){ minimizer.click(); }
        }
        switchCheckbox("bossRandomization");
    }

    var escapeRando = document.getElementById("escapeRando");
    escapeRando.onchange = function(){
        var escapeRando = document.getElementById("escapeRando");
        var removeEscapeEnemies = document.getElementById("removeEscapeEnemies");

        if(escapeRando.checked){
            disableElement("removeEscapeEnemies", false);
            disableElement("animals", true);
            if(! removeEscapeEnemies.checked){ removeEscapeEnemies.click(); }
        } else {
            if(removeEscapeEnemies.checked){ removeEscapeEnemies.click(); }
            disableElement("removeEscapeEnemies", true);
            disableElement("animals", false);
        }
        switchCheckbox("escapeRando");
    }
    if(! escapeRando.checked){
        disableElement("removeEscapeEnemies", true);
    }
    if(escapeRando.checked){
        disableElement("animals", true);
    }

    // uncheck suits restrictions when late morph + area
    var lateMorph = document.getElementById("morphPlacement");
    lateMorph.onchange = function(){
        var lateMorph = document.getElementById("morphPlacement");
        var area = document.getElementById("areaRandomization");
        var suits = document.getElementById("suitsRestriction");

        if(lateMorph.options[lateMorph.selectedIndex].text == "late"){
            if(area.checked){
                if(suits.checked){
                    suits.click();
                }
            }
        }
    }

    var progSpeed = document.getElementById("progressionSpeed");
    progSpeed.onchange = function(){
        var progSpeed = document.getElementById("progressionSpeed");
        if(progSpeed.value == 'slow' || progSpeed.value == 'slowest'){
            // set suits restriction only if not area + late morph
            var suitsRestriction = document.getElementById("suitsRestriction");
            var lateMorph = document.getElementById("morphPlacement");
            var area = document.getElementById("areaRandomization");
            if(! suitsRestriction.checked && ! (area.checked && lateMorph.options[lateMorph.selectedIndex].text == "late")){
                suitsRestriction.click();
            }
        }
        if(progSpeed.value == 'fast' || progSpeed.value == 'fastest'){
            var suitsRestriction = document.getElementById("suitsRestriction");

            if(suitsRestriction.checked){
                suitsRestriction.click();
            }
        }
    }

    // change parameters depending on start location value
    var startLocation = document.getElementById("startLocation");
    startLocation.onchange = function(){
        var startLocation = document.getElementById("startLocation");

        var selected = startLocation.value; //startLocation.options[startLocation.selectedIndex].text;
        if(selected != "Ceres" && selected != "Landing Site"){
            var morphPlacement = document.getElementById("morphPlacement");
            var majorsSplit = document.getElementById("majorsSplit");
            var variaTweaks = document.getElementById("variaTweaks");
            var layoutPatches = document.getElementById("layoutPatches");
            var suitsRestriction = document.getElementById("suitsRestriction");

            if(morphPlacement.value != "normal") {
                morphPlacement.value = "normal";
            }
            if(majorsSplit.value != "Full") {
                majorsSplit.value = "Full";
            }
            if(variaTweaks.checked == false) {
                variaTweaks.click();
            }
            if(layoutPatches.checked == false) {
                layoutPatches.click();
            }
            if(suitsRestriction.checked == true) {
                suitsRestriction.click();
            }
            if(selected == "Red Brinstar Elevator" || selected == "Golden Four") {
                var areaRandomization = document.getElementById("areaRandomization");
                var areaLayout = document.getElementById("areaLayout");
                if(areaRandomization.checked == false) {
                    areaRandomization.click();
                }
                if(areaLayout.checked == false) {
                    areaLayout.click();
                }
            }
        }
    }

    // race mode is disabled by default
    var text = document.getElementById("raceModeText");
    text.className = "disabledText";

    var raceMode = document.getElementById("raceMode");
    raceMode.onchange = function() {
      var raceMode = document.getElementById("raceMode");
      var text = document.getElementById("raceModeText");
      if(raceMode.checked){
        text.className = "";
      } else {
        text.className = "disabledText";
      }
      switchCheckbox("raceMode");
    }

    // set boss + area rando when minimizer is on
    var minimizer = document.getElementById("minimizer");
    minimizer.onchange = function() {
        var boss = document.getElementById("bossRandomization");
        var area = document.getElementById("areaRandomization");
        var minimizerTourian = document.getElementById("minimizerTourian");

        if(minimizer.checked) {
            if(! boss.checked){ boss.click(); }
            if(! area.checked){ area.click(); }
            disableElement("minimizerQty", false);
            disableElement("minimizerTourian", false);
            if(! minimizerTourian.checked){ minimizerTourian.click(); }
        } else {
            if(minimizerTourian.checked){ minimizerTourian.click(); }
            disableElement("minimizerQty", true);
            disableElement("minimizerTourian", true);
            var minimizerRandom = document.getElementById("minimizerQtyRandom");
            if(isElemRandom(minimizerRandom)) {
                minimizerRandom.className = minimizerRandom.className.replace(" active", "");
            }
        }
        switchCheckbox("minimizer");
    }
    if(minimizer.checked) {
        disableElement("minimizerQty", false);
        disableElement("minimizerTourian", false);
    } else {
        disableElement("minimizerQty", true);
        disableElement("minimizerTourian", true);
        var minimizerRandom = document.getElementById("minimizerQtyRandom");
        if(isElemRandom(minimizerRandom)) {
            minimizerRandom.className = minimizerRandom.className.replace(" active", "");
        }
    }

    var inputs = document.getElementsByTagName("input");
    for(var i = 0; i < inputs.length; i++) {
        if(inputs[i].type == "checkbox") {
            // progression speed checkboxes don't need switchery, so they don't have a name property
            if(inputs[i].name != "") {
              var s = new Switchery(document.getElementById(inputs[i].name), { size: 'small', color: '#ddd' });
              globalSwitchs[inputs[i].name] = s;
            }
        }
    }

    setComplexity();

    setRandom();

    $("#preset").chosen();
    $("#randoPreset").chosen();
    resizeChosen();

    // check if a vanilla ROM is already in local storage
    localforage.getItem('vanillaROM', function(err, value) {
        if(err != null) {
            clearLocalStorage();
        } else {
            if(value != null) {
                vanillaROMStored = true;
                displayROMInput(false);
                vanillaROM = value;
                vanillaROMStored = true;
            } else {
                clearLocalStorage();
            }
        }
    });
}

function displayROMInput(show) {
    if(show == true) {
        document.getElementById("uploadFileVisibility").style.display = "block";
        document.getElementById("uploadFileOKVisibility").style.display = "none";
    } else {
        document.getElementById("uploadFileVisibility").style.display = "none";
        document.getElementById("uploadFileOKVisibility").style.display = "block";
    }
}

function clearLocalStorage() {
    displayROMInput(true);
    localforage.clear();
    vanillaROMStored = false;
    vanillaROM = null;
}

function switchCheckbox(id, elems=[]) {
  var check = document.getElementById(id);
  if(check.checked){
    check.value = "on";
  } else {
    check.value = "off";
  }

  for(var i=0; i<elems.length; i++){
    disableElement(elems[i], check.checked);
  }
}

function loadRandoPreset() {
  console.log("loadRandoPreset: "+document.getElementById("randoPreset").value);

  var dataDict = {"randoPreset": document.getElementById("randoPreset").value, "origin": "randomizer"};

  // call web service to update the session with the params from the rando preset and update the parameters in the page
  var request = $.ajax({
      url: "{{=URL(f='randoPresetWebService')}}",
      method: "POST",
      data: dataDict,
      dataType: "json"
  });

  request.done(loadRandoPresetOK);
  request.fail(ajaxFail);
}

function loadRandoPresetOK(data) {
  // instead of reloading the page which remove the sm ROM, update all fields manually
  for(var key in data) {
    value = data[key];
    var elem = document.getElementById(key);

    var elemRandom = document.getElementById(key+"Random");
    if(value == "random") {
      // if not already set as random, set it
      if(! isElemRandom(elemRandom)) {
        randomize({currentTarget: elemRandom}, key);
      }
    } else {
      // check if it was random before
      if(elemRandom != null && isElemRandom(elemRandom)) {
        randomize({currentTarget: elemRandom}, key);
      }

      // tell switchery for checkboxes
      if(key in globalSwitchs) {
        if(value != elem.value){
          elem.click();
        }
      }

      elem.value = value;
      if(chosenElements.includes(key)) {
        $("#"+key).val(value).trigger("chosen:updated");
      }
    }
  }

  // check if multi select has been set by the rando preset, otherwise load default values
  for(var key in defaultMultiValues) {
      if(! (key+"MultiSelect" in data) ) {
          $("#"+key+"MultiSelect").val(defaultMultiValues[key]).trigger("chosen:updated");
      }
  }
}

function startTheTour(step=-1) {
  // the tour tutorial
  var tour = new Tour({
    storage: false,
    autoscroll: false,
    steps: [
    {
      element: "#permalinkStep",
      title: "Permanent link",
      content: "Use this permalink to share your seed with other players.<br/><b>Notes:</b> You have to click at least once on the link to activate it, else it won't work after seven days. If you want to retrieve a previous seed (from less than seven days ago) and lost the link, you can search for it at the bottom of <a href=\"/stats\" target=\"_blank\">VARIA usage statistics page</a> (search for your seed number in the page)."
    },
    {
      element: "#romStep",
      title: "Vanilla Super Metroid ROM",
      content: "<p>Use an American/Japan unheadered ROM of Super Metroid.<br/>\
The vanilla ROM is stored in the browser local storage and is never sent to our server, all the patching is done locally in the browser.</p>"
    },
    {
      element: "#seedStep",
      title: "Randomizer seed",
      content: "Choose a seed number between 1 and {{=maxsize}}, choose 0 to generate a random one."
    },
    {
      element: "#presetStep",
      title: "Skills Preset",
      content: "<p>The preset is used by the Randomizer to know which techniques are available to reach the items locations.</p><p>You can check which techniques are required as well as create and manage your own preset on the <a href=\"/solver/solver_web/presets\" target=\"_blank\">Presets part of the website</a>.</p><p>Load one of the standard presets (sorted in increased difficulty), tournament presets, or your own from the community presets.</p><p>Creating your own preset will lead to a better experience overall, as the generated ROMs will be tailored for you.</p><p><b>Standard presets outlook:</b><br/><ul><li><b>newbie: </b>New to randomizers, but completed Super Metroid 100% and knows basic techniques (Wall Jump, Shinespark, Mid-air Morph)</li><li><b>casual:</b> occasional rando player. No hell runs or suitless Maridia, some easy to learn tricks in logic.</li><li><b>regular: </b>plays rando regularly. Knows tricks that are not too hard and open up the game: hell runs (generous energy requirements), suitless Maridia, lava dive, gate glitches, Alcatraz, Gauntlet...</li><li><b>veteran:</b> experienced rando player. Harder everything, some tougher tricks in logic.</li><li><b>expert: </b>knows almost all tricks: full suitless Maridia, Lower Norfair hell runs, hi-jumpless Lava Dive (mania difficulty only, so not by default in most rando settings)</li><li><b>master:</b> Everything on hardest, all tricks known.</li></ul></p>"
    },
    {
      element: "#randoPresetStep",
      title: "Settings Preset",
      content: "Choose from a list of typical Randomizer usages. They're independent from skills preset, and settings can still be changed after loading the preset:<ul>\
{{for preset in randoPresets:
    if preset == "":
      continue
    response.write("<li>{}: {}</li>\\\n".format(preset, randoPresetsDesc.get(preset, "")), escape=False)
    pass}}\
</ul>\
Tournament presets:\
<ul>\
{{for preset in tourRandoPresets:
    response.write("<li>{}: {}</li>\\\n".format(preset, randoPresetsDesc.get(preset, "")), escape=False)
    pass}}\
</ul>"
    },
    {
      element: "#raceStep",
      title: "Race",
      content: "<p>When enabled, makes it difficult to cheat by using a Super Metroid editor like SMILE.</p>\
<p>You won't be able to solve/track a race protected seed on the VARIA website.</p>"
    },
    {
      element: "#StartLocationStep",
      title: "Start location",
      content: "<p>Choose where you want to start the game:\
<table class=\"full\">\
<tr>\
<td>Red Brinstar elevator top door is always blue:</td><td><img src=\"/solver/static/images/red_bt_blue_door.png\" alt=\"Red Brinstar blue door\" title=\"Red Brinstar blue door\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<tr><td colspan=3 class=\"blankLastRow\"></td></tr>\
<th>Start location</th><th colspan=\"2\">Layout modification</th>\
</tr>\
<tr>\
<td>Ceres Station</td><td>Blue Brinstar blue door</td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/ceres_start.png\" alt=\"Ceres\" title=\"Ceres\" class=\"full\"/></td><td><img src=\"/solver/static/images/blue_bt_blue_door.png\" alt=\"Blue Brinstar blue door\" title=\"Blue Brinstar blue door\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<td>Landing Site</td><td>Blue Brinstar blue door</td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/landing_site_start.png\" alt=\"Landing Site\" title=\"Landing Site\" class=\"full\"/></td><td><img src=\"/solver/static/images/blue_bt_blue_door.png\" alt=\"Blue Brinstar blue door\" title=\"Blue Brinstar blue door\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<td>Gauntlet Top</td><td></td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/gauntlet_start.png\" alt=\"Gauntlet\" title=\"Gauntlet\" class=\"full\"/></td><td></td><td></td>\
</tr>\
<tr>\
<td>Green Brinstar Elevator</td><td>Brinstar reserve blue door</td><td>Brinstar reserve blue door</td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/green_bt_elevator_start.png\" alt=\"Green Brinstar Elevator\" title=\"Green Brinstar Elevator\" class=\"full\"/></td><td><img src=\"/solver/static/images/bt_reserve_blue_door1.png\" alt=\"Brinstar reserve blue door\" title=\"Brinstar reserve blue door\" class=\"full\"/></td><td><img src=\"/solver/static/images/bt_reserve_blue_door2.png\" alt=\"Brinstar reserve blue door\" title=\"Brinstar reserve blue door\" class=\"full\"/></td>\
</tr>\
<tr>\
<td>Big Pink</td><td></td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/big_pink_start.png\" alt=\"Big Pink\" title=\"Big Pink\" class=\"full\"/></td><td></td><td></td>\
</tr>\
<tr>\
<td>Etecoons Supers</td><td>Etecoons Super blue door</td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/etecoons_supers_start.png\" alt=\"Etecoons Supers\" title=\"Etecoons Supers\" class=\"full\"/></td><td><img src=\"/solver/static/images/etecoons_blue_door.png\" alt=\"Etecoons Super blue door\" title=\"Etecoons Super blue door\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<td>Wrecked Ship Main</td><td>Sponge Bath blue door</td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/wrecked_ship_start.png\" alt=\"Wrecked Ship Main\" title=\"Wrecked Ship Main\" class=\"full\"/></td><td><img src=\"/solver/static/images/sponge_bath_blue_door.png\" alt=\"Sponge Bath blue door\" title=\"Sponge Bath blue door\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<td>Firefleas Top (heat removed)</td><td>Fune removed</td><td>Shot blocks at save station</td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/firefleas_top_start.png\" alt=\"Firefleas Top\" title=\"Firefleas Top\" class=\"full\"/></td><td><img src=\"/solver/static/images/fune_removed.png\" alt=\"Fune removed\" title=\"Fune removed\" class=\"full\"/></td><td><img src=\"/solver/static/images/firefleas_shot_blocks.png\" alt=\"Firefleas shot blocks\" title=\"Firefleas shot blocks\" class=\"full\"/></td>\
</tr>\
<tr>\
<td>Business Center</td><td>Hi-Jump area blue door</td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/business_center_start.png\" alt=\"Business Center\" title=\"Business Center\" class=\"full\"/></td><td><img src=\"/solver/static/images/hijump_blue_door.png\" alt=\"Hi-Jump area blue door\" title=\"Hi-Jump area blue door\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<td>Bubble Mountain</td><td>Speed area blue door</td><td>Speed area blue door</td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/bubble_mountain_start.png\" alt=\"Bubble Mountain\" title=\"Bubble Mountain\" class=\"full\"/></td><td><img src=\"/solver/static/images/speed_blue_door1.png\" alt=\"Speed area blue door\" title=\"Speed area blue door\" class=\"full\"/></td><td><img src=\"/solver/static/images/speed_blue_door2.png\" alt=\"Speed area blue door\" title=\"Speed area blue door\" class=\"full\"/></td>\
</tr>\
<tr>\
<td>Mama Turtle</td><td>Mama Turtle blue door</td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/mama_turtle_start.png\" alt=\"Mama Turtle\" title=\"Mama Turtle\" class=\"full\"/></td><td><img src=\"/solver/static/images/mama_turtle_blue_door.png\" alt=\"Mama Turtle blue door\" title=\"Mama Turtle blue door\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<td>Watering Hole</td><td>Maridia tube opened</td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/watering_hole_start.png\" alt=\"Watering Hole\" title=\"Watering Hole\" class=\"full\"/></td><td><img src=\"/solver/static/images/maridia_tube_opened.png\" alt=\"Maridia tube opened\" title=\"Maridia tube opened\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<td>Aqueduct</td><td>Aqueduct Save blue door</td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/aqueduct_start.png\" alt=\"Aqueduct\" title=\"Aqueduct\" class=\"full\"/></td><td><img src=\"/solver/static/images/aqueduct_save_blue.png\" alt=\"Aqueduct Save door\" title=\"Aqueduct Save door\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<td>Red Brinstar Elevator</td><td>Hellway blue door</td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/red_bt_elevator_start.png\" alt=\"Red Brinstar Elevator\" title=\"Red Brinstar Elevator\" class=\"full\"/></td><td><img src=\"/solver/static/images/hellway_blue_door.png\" alt=\"Hellway blue door\" title=\"Hellway blue door\" class=\"full\"/></td><td></td>\
</tr>\
<tr>\
<td>Golden Four</td><td></td><td></td>\
</tr>\
<tr>\
<td><img src=\"/solver/static/images/golden_four_start.png\" alt=\"Golden Four\" title=\"Golden Four\" class=\"full\"/></td><td></td><td></td>\
</tr>\
</table>\
</p>\
<p>Patches developed by Flo.</p>"
    },
    {
      element: "#majorsSplitStep",
      title: "Majors Split",
      content: "<p>Chooze how you want to split the Majors and the Minors items:<ul><li>Full: All items are shuffled in all locations</li><li>Majors/Minors: Use major (upgrades and energy) and minor (ammo) item pools.</p><p><b>Note:</b> High-Jump boots Energy Tank location is considered minor, and right Super Missile in Wrecked ship is considered major for balancing purposes.</li><li>Chozo: Put all the upgrades as well as minimal ammo/energy to finish the seed in the Chozo locations. Theses are the Chozo statues, Morph Ball and boss item locations (Right Super in Wrecked Ship, Varia Suit, Ridley ETank). Depending on progresson speed and item distribution settings, you will be able to 'sequence break' by going to other locations as well.</li></ul></p><p>Check the map for the list of Majors and Chozo locations and items:<br/><a href=\"/solver/static/images/chozo_map.png\" class=\"highslide\" onclick=\"return hs.expand(this, {wrapperClassName: 'borderless', dimmingOpacity: 0.75, align: 'center'})\"><div class=\"parent-center\"><img id=\"chozoThumb\" src=\"/solver/static/images/chozo_map_thumbnail.png\" alt=\"Chozo Map\" title=\"Click to enlarge\" class=\"child-center half\"/></div></a></p><p>Using a non-standard or randomized start location will force this setting to 'Full'.</p><p>Click on the dice button to randomly set this parameter.</p>"
    },
    {
      element: "#maxDifficultyStep",
      title: "Maximum difficulty for picking up an item",
      content: "<p>Depending on the perceived difficulties of the techniques, bosses, hell runs etc. from the preset, it will prevent the Randomizer from placing an item in a location too difficult to reach with the current items.</p><p><b>Warning:</b> if too low may cause the randomizer to up the difficulty for some boss fight.</p>"
    },
    {
      element: "#progSpeedStep",
      title: "Progression speed",
      content: "<p>A progression item can be a suit, a movement item, or any item that opens up new locations. This parameter influences how fast progression items are likely to be found.<br/>\
Standard speeds go from <b>slowest</b>, stuffing your way with as many non-progression items as possible, to <b>fastest</b>, where you will be able to visit Zebes pretty shortly.</p><p><b>VARIAble</b> speed will randomly change internal progression speed while placing items, creating seeds that are more unpredictable.</p><p>You can also pick <b>basic</b>, in which case VARIA will place the items exactly like Dessyreqt Randomizer, or Total Randomizer in its Normal/Casual setting (ie: front fill placement).</p>\
<p>The <b>speedrun</b> progression speed uses a random fill algorithm, which allows for a more uniform placement of items. Good setting for racing, item hunts are less likely.</p>\
<p>Click on the dice button to access <b>random progression speed</b> mode where you can choose on which progression speeds the randomization will take place.</p>\
<p><b>Note:</b> usually, slower settings will result in more difficult seeds, and faster settings in easier seeds. Basic progression speed usually results in easy/fast seeds, but not always.</p>"
    },
    {
      element: "#progDiffStep",
      title: "Progression difficulty",
      content: "<p>This parameter influences the choice of the next location. It uses the perceived difficulties from the preset to compute the difficulty to reach the locations. Then if <b>easier</b> or <b>harder</b> is selected, the easiest or hardest location will have a higher chance of being chosen.<br/>Set it to <b>normal</b> for the Randomizer to randomly choose the next location.</p><p><b>Note:</b> this setting has less of an influence on actual seed difficulty than Progression Speed.</p><p>Click on the dice button to randomly set this parameter.</p>"
    },
    {
      element: "#morphPlacementStep",
      title: "Morph Placement",
      content: "<p>Influences where VARIA will place Morphing Ball :<ul><li><b>early</b> (default): Morph will be placed as soon as possible</li><li><b>normal</b>: Morph will be placed randomly</li><li><b>late</b>: Prevents Morph to be placed in the first available locations of the game. Best suited when used along area randomization, to find Morph in peculiar places.<br/><b>Warning: </b>In Chozo Majors Split, or when using a non-standard or randomized start location, <b>late</b> will be replace by <b>normal</b></li></ul></p><p>Click on the dice button to randomly set this parameter.</p>"
    },
    {
      element: "#suitsRestrictionStep",
      title: "Suits restriction",
      content: "<p>Prevent Gravity or Varia suits to be placed early in the game (Crateria/Blue Brinstar). Using a non-standard or randomized start location will force this setting off.</p><p>Click on the dice button to randomly set this parameter.</p>"
    },
    {
      element: "#hideItemsStep",
      title: "Hide Items",
      content: "<p>Hides half of the visible items.<br/>Items always visible:<ul><li>Energy Tank, Gauntlet</li><li>Energy Tank, Terminator</li><li>Morphing Ball</li><li>Missile (Crateria moat)</li><li>Missile (green Brinstar below super missile)</li><li>Missile (above Crocomire)</li><li>Power Bomb (lower Norfair above fire flea room)</li><li>Missile (Gravity Suit)</li><li>Missile (green Maridia shinespark)</li></ul></p><p>Click on the dice button to randomly set this parameter.</p>"
    },
    {
      element: "#strictMinorsStep",
      title: "Strict ammo distribution",
      content: "<p>Instead of using the Minors proportions as probabilities, enforce a strict distribution to match the proportions as exactly as possible.</p><p>Click on the dice button to randomly set this parameter.</p>"
    },
    {
      element: "#missileQtyStep",
      title: "Proportion of Missiles/Super Missiles/Power Bombs",
      content: "<p>For each minor types, the higher the number the higher the probability of choosing it when placing a minor.</p><p>Click on the dice button to randomly set this parameter.</p>"
    },
    {
      element: "#minorQtyStep",
      title: "Percentage of minors available",
      content: "<p>From 7%: minimum number of minors required to finish the game to 100%: all minors locations contain a minor (vanilla like).</p><p>Click on the dice button to randomly set this parameter.</p>"
    },
    {
      element: "#energyQtyStep",
      title: "Quantity of Energy/Reserve Tanks available",
      content: "<p>Choose how many Energy/Reserve Tanks will be available, from 0-1 in ultra sparse, 4-6 in sparse, 8-12 in medium and 18 in vanilla.</p><p>In ultra sparse Mother Brain's rainbow beam only do 20 damage instead of 300.</p><p>Click on the dice button to randomly set this parameter.</p>"
    },
    {
      element: "#areaRandomizationStep",
      title: "Areas randomization",
      content: "<p>Randomize areas together using bidirectional access portals:</p>\
<a href=\"/solver/static/images/area_map_20200112.png\" class=\"highslide\" onclick=\"return hs.expand(this, {wrapperClassName: 'borderless', dimmingOpacity: 0.75, align: 'center'})\"><div class=\"parent-center\"><img id=\"areathumb\" src=\"/solver/static/images/area_map_thumbnail.png\" alt=\"Area Map\" title=\"Click to enlarge\" class=\"half child-center\"/></div></a>\
<p>It is recommended to use the <a href=\"/solver/solver_web/tracker\" target=\"_blank\">Area Tracker</a> to find your way more easily.</p>\
<p>All portals can be linked to one another, even if it means following an incompatible transition (Left-Left, Up-Right, ...).</p>\
<p>By default, the escape sequence will spawn you outside a random map station, and you have to find your way to the ship. See Escape Randomization section (in medium/advanced tab) for more information.</p>\
<p>You can go through all portals and back, even those where you can't do that in vanilla, so some layout tweaks have been made:\
<table class=\"full\">\
<tr>\
<td class=\"knowsUsed\"><p class=\"top\">Remove Maridia red fish exit green gate:</td>\
<td class=\"knowsUsed\"><p class=\"top\">Remove Maridia tube exit green gate:</td>\
<td class=\"knowsUsed\"><p class=\"top\">Remove Lower Norfair exit crumble blocks:</td>\
<td class=\"knowsUsed\"><p class=\"top\">Wrecked Ship save station is always active:</td>\
<td class=\"knowsUsed\"><p class=\"top\">Remove yellow door at Crateria Kihunter room:</td>\
</tr>\
<tr>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/fish_gate.png\" alt=\"fish_gate.png\" title=\"fish_gate.png\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/tube_gate.png\" alt=\"tube_gate.png\" title=\"tube_gate.png\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/ln_gate.png\" alt=\"ln_gate.png\" title=\"ln_gate.png\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/ws_save.png\" alt=\"ws_save.png\" title=\"ws_save.png\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/kihunter_blue_door.png\" alt=\"kihunter_blue_door.png\" title=\"kihunter_blue_door.png\" class=\"full\"/></td>\
</tr>\
<tr>\
<td class=\"knowsUsed\"><p class=\"top\">Remove yellow door at Green Hill Zone:</td>\
<td class=\"knowsUsed\"><p class=\"top\">Remove green door at Noob Bridge:</td>\
<td class=\"knowsUsed\"><p class=\"top\">Remove yellow door at Le Coude:</td>\
<td class=\"knowsUsed\"><p class=\"top\">Remove yellow door at Kronic Boost room:</td>\
<td class=\"knowsUsed\"><p class=\"top\">Remove red door at Green Pirates Shaft:</td>\
</tr>\
<tr>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/blue_door_greenhill.png\" alt=\"blue_door_greenhill.png\" title=\"blue_door_greenhill.png\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/blue_door_noob.png\" alt=\"blue_door_noob.png\" title=\"blue_door_noob.png\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/blue_door_lecoude.png\" alt=\"blue_door_lecoude.png\" title=\"blue_door_lecoude.png\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/blue_door_kronic.png\" alt=\"blue_door_kronic.png\" title=\"blue_door_kronic.png\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/pirates_shaft_blue_door.png\" alt=\"pirates_shaft_blue_door.png\" title=\"pirates_shaft_blue_door.png\" class=\"full\"/></td>\
</tr>\
</table>\
</p>\
<p>Even with all layout modifications, it is still possible to softlock in some occurrences. To avoid softlocking your save file, an automatic rolling backup save system is enabled. See doors colors randomization option help for more details.</p>\
Click on the dice button to randomly set this parameter.",
      placement: "auto left"
    },
    {
      element: "#lightAreaRandomizationStep",
      title: "Light Area Randomization",
      content: "<p>In Light Area Randomization we keep the same number of transitions between areas as in vanilla.<br/>\
So Crocomire area will always be connected to Upper Norfair, there'll always be two transitions between Crateria/blue Brinstar and green/pink Brinstar, ...<br/>\
This mode can be use as an introduction before doing full Area Randomization or to get less lost when you don't use the Area Tracker.</p>\
<p>When 'Areas randomization' dice button is on, Light Area Randomization is greyed and it's not used.</p>",
      placement: "auto left"
    },
    {
      element: "#areaLayoutStep",
      title: "Areas randomization additional layout modifications",
      content: "Some layout tweaks to make your life easier in areas randomizer:\
<table class=\"full\">\
<tr>\
<td class=\"quarter\"><p class=\"top\">Remove Crab green gate in Marida:</p></td>\
<td class=\"quarter\"><p class=\"top\">Remove blue gate in Green Hill Zone:</p></td>\
<td class=\"quarter\"><p class=\"top\">New platform in Green Hill Zone to access transition door:</p></td>\
</tr>\
<tr>\
<td class=\"quarter\"><img src=\"/solver/static/images/crab_gate.png\" alt=\"crab_gate\" title=\"crab_gate\" class=\"full\"/></td>\
<td class=\"quarter\"><img src=\"/solver/static/images/greenhill_gate.png\" alt=\"greenhill_gate\" title=\"greenhill_gate\" class=\"full\"/></td>\
<td class=\"quarter\"><img src=\"/solver/static/images/greenhill_platform.png\" alt=\"greenhill_platform\" title=\"greenhill_platform\" class=\"full\"/></td>\
</tr>\
<tr>\
<td class=\"quarter\"><p class=\"top\">Access Maridia red fish exit:</p></td>\
<td class=\"quarter\"><p class=\"top\">Access Maridia tube exit:</p></td>\
<td class=\"quarter\"><p class=\"top\">Access Lower Norfair exit:</p></td>\
</tr>\
<tr>\
<td class=\"quarter\"><img src=\"/solver/static/images/fish_access.png\" alt=\"fish_access\" title=\"fish_access\" class=\"full\"/></td>\
<td class=\"quarter\"><img src=\"/solver/static/images/tube_access.png\" alt=\"tube_access\" title=\"tube_access\" class=\"full\"/></td>\
<td class=\"quarter\"><img src=\"/solver/static/images/ln_access.png\" alt=\"ln_access\" title=\"ln_access\" class=\"full\"/></td>\
</tr>\
<td class=\"quarter\" colspan=\"3\"><p class=\"top\">Sponge Bath door is set to blue to avoid softlocking and two new platforms are added to traverse Forgotten Highway both ways with only High-Jump boots and Level 1 underwater movement in preset:</p></td>\
<tr>\
</tr>\
<tr>\
<td class=\"quarter\"><img src=\"/solver/static/images/sponge_bath_blue_door.png\" alt=\"sponge_bath_blue_door\" title=\"sponge_bath_blue_door\" class=\"full\"/></td>\
<td class=\"quarter\"><img src=\"/solver/static/images/forgotten_all_the_way.png\" alt=\"forgotten_all_the_way\" title=\"forgotten_all_the_way\" class=\"full\"/></td>\
</tr>\
</table>\
<p>Using Area randomization and a non-standard or randomized start location will force this setting on.</p>",
      placement: "auto left"
    },
    {
      element: "#doorsColorsRandoStep",
      title: "Doors Colors Randomization",
      content: "<p>Randomize the color of Red/Green/Yellow doors.<br/>\
Add four new type of doors which require Ice/Wave/Spazer/Plasma beams to open them.<br/>\
<table>\
<tr><td><img src=\"/solver/static/images/Missile.png\" class=\"centerIcon\"></td><td><img src=\"/solver/static/images/missile_door.png\" class=\"marginRight\"></td>\
<td><img src=\"/solver/static/images/Super.png\" class=\"centerIcon\"></td><td><img src=\"/solver/static/images/super_door.png\" class=\"marginRight\"></td>\
<td><img src=\"/solver/static/images/PowerBomb.png\" class=\"centerIcon\"></td><td><img src=\"/solver/static/images/powerbomb_door.png\" class=\"marginRight\"></td><td></td></tr>\
<tr><td><img src=\"/solver/static/images/Wave.png\" class=\"centerIcon\"></td><td><img src=\"/solver/static/images/wave_door.png\" class=\"marginRight\"></td>\
<td><img src=\"/solver/static/images/Plasma.png\" class=\"centerIcon\"></td><td><img src=\"/solver/static/images/plasma_door.png\" class=\"marginRight\"></td>\
<td><img src=\"/solver/static/images/Spazer.png\" class=\"centerIcon\"></td><td><img src=\"/solver/static/images/spazer_door.png\" class=\"marginRight\"></td>\
<td><img src=\"/solver/static/images/Ice.png\" class=\"centerIcon\"></td><td><img src=\"/solver/static/images/ice_door.png\" class=\"marginRight\"></td></tr>\
</table>\
Missile doors can no longer be opened with a Super Missile. Only one Missile is required to open a Missile door.<br/>\
For Plasma/Spazer doors, when you have both beams collected and one equipped you can open both door types.<br/>\
Colored doors to save stations / refills / map stations are excluded from randomization.<br/>\
Colored doors to save / refill stations are forced to blue.<br/>\
The fill algorithm will be more trolly about ammo/beam if you use slower progression speed.</p>\
<p>In this mode there are seven distinct door keys, and sometimes (especially with non standard starting location or area rando), if you go through a blue door you can end up locked on the other side if you don't have or find the item required to come back. If you save in that situation, your save file will be hardlocked. To avoid this, a rolling backup save system is enabled. When you save at a different save station than the last time, a backup of your previous save is done, using an empty save, or an older backup of the same game. You can identify backups in the load menu, as they will have the same slot letter as the original save :</p>\
<img src=\"/solver/static/images/backup_saves.png\" alt=\"backup_saves.png\" title=\"Backup Saves menu example\" class=\"third center_img\"/>\
<p>As soon as you load a backup save from the menu, it becomes its own slot. In the example above, if you load your most recent backup (with 0:06 time), it will become 'Samus C'. When playing this new slot C game, when you save, it won't be able to backup, since other slots are taken by the original A slot and an older backup of the A slot. So if you hardlock a save file, be sure to clear it for it to be reused as a backup afterwards.</p>\
<p>Click on the dice button to randomly set this parameter.</p>\
Beams doors patch by Mettyk25jigsaw.<br/>\
Beams doors gfx by prankard.<br/>\
CRE gfx fix by Sirkura.<br/>\
Rolling backup and Missile doors patches by Flo.",
      placement: "auto left"
    },
    {
      element: "#doorsColorsGreyStep",
      title: "Allow some doors to be grey",
      content: "<p>When randomizing the color of Red/Green/Yellow doors, some doors can be randomized to Grey.<br/>\
Grey doors will never open, you will have to go around them.</p>",
      placement: "auto left"
    },
    {
      element: "#bossRandomizationStep",
      title: "Bosses randomization",
      content: "<p>Randomize Golden 4 bosses access doors (<a href=\"https://wiki.supermetroid.run/Kraid\" target=\"_blank\">Kraid</a>, <a href=\"https://wiki.supermetroid.run/Phantoon\" target=\"_blank\">Phantoon</a>, <a href=\"https://wiki.supermetroid.run/Draygon\" target=\"_blank\">Draygon</a>, <a href=\"https://wiki.supermetroid.run/Ridley\" target=\"_blank\">Ridley</a>) using bidirectional access portals (the same access portals as in Areas randomization).</p>\
<p>The areas or rooms unlocked by the bosses stay unchanged. For example, you still have to kill Phantoon to activate Wrecked Ship.</p>\
<p>Wrecked Ship save station is always active:</p>\
<table class=\"quarter\">\
<tr><td><img src=\"/solver/static/images/ws_save.png\" alt=\"ws_save.png\" title=\"ws_save.png\" class=\"full\"/></td></tr>\
</table>\
Click on the dice button to randomly set this parameter.",
      placement: "auto left"
    },
    {
      element: "#minimizerStep",
      title: "Minimizer",
      content: "<p>Create a <b>'boss rush'</b> seed with a minimal layout by only connecting together enough areas to match the given number of locations (from 30 to 100). There will usually be slightly more locations available. <br/>\
You can generate anything from a densely packed game with just Crateria, Wrecked Ship, and bosses, to a full area+boss rando<br/>\
<b>Boss and Area transitions are mixed together</b>, Gadoras are removed, and you can <b>exit boss fights</b> at any point (they are also considered dead as soon as they start exploding instead of when the drops appear).</p>\
<p>\
You can also <b>speed up Tourian</b> (on by default), to skip Metroids, Zebetites, and all cutscenes (including Mother Brain 3 fight). Golden Four statues are replaced by an invicible Gadora until all bosses are dead. It also adds a layout patch to open the Zebetites to pass them without Morph, allowing the creation of morphless plandos.\
</p>\
<p>Minimizer layout example:<a href=\"/solver/static/images/minimizer_example.png\" class=\"highslide\" onclick=\"return hs.expand(this, {wrapperClassName: 'borderless', dimmingOpacity: 0.75, align: 'center'})\"><div class=\"parent-center\"><img id=\"minimizerThumb\" src=\"/solver/static/images/minimizer_example_thumbnail.png\" alt=\"Minimizer example\" title=\"Click to enlarge\" class=\"child-center half\"/></div></a></p>\
<b>Note:</b> will set Area and Boss randomization.<br/>\
Click on the dice button to randomly set the number of locations (between 30 and 60).",
      placement: "auto left"
    },
    {
      element: "#escapeRandoStep",
      title: "Escape sequence randomization",
      content: "<p>When leaving Tourian, get teleported to the exit of a random Map station (between Brinstar/Maridia/Norfair/Wrecked Ship).<br/>You then have to find your way to the ship in the remaining time. Allotted time depends on area layout, but not on skill settings and is pretty generous.</p>\
During the escape sequence:\
<ul>\
<li>All doors are opened</li>\
<li>Maridia tube is opened</li>\
<li>The Hyper Beam can destroy Bomb, Power Bomb and Super Missile blocks and open blue/green gates from both sides</li>\
<li>All mini bosses are defeated</li>\
<li>All minor enemies are removed to allow you to move faster and remove lag</li>\
</ul>\
<p>During regular game only Crateria Map station door can be opened and activating the station will act as if all map stations were activated at once.</p>\
<b>Animals Challenges:</b>\
<p>You can use the extra available time to:\
<ul>\
<li>find the animals that are hidden behind a (now blue) map station door</li>\
<li>go the vanilla animals door to cycle through the 4 available escapes, and complete as many escapes as you can</li>\
</ul>\
Pick your challenge, or try to do both, but watch your timer!</p>",
      placement: "auto left"
    },
    {
      element: "#removeEscapeEnemiesStep",
      title: "Remove enemies during escape",
      content: "<p>Remove enemies during escape sequence, disable it to blast through enemies with your Hyper Beam and cause lag.</p>",
      placement: "auto left"
    },
    {
      element: "#funCombatStep",
      title: "Super Fun Combat",
      content: "<p>Forces removal of Plasma Beam <img src=\"/solver/static/images/Plasma.png\" alt=\"Plasma.png\" title=\"Plasma.png\" class=\"width: 32px\"/>, and Screw Attack <img src=\"/solver/static/images/ScrewAttack.png\" alt=\"ScrewAttack.png\" title=\"ScrewAttack.png\" class=\"width: 32px\"/> if the preset and settings allow it.<br/>In addition, can randomly remove some items from the Combat set:</p>\
<ul>\
<li><img src=\"/solver/static/images/Spazer.png\" alt=\"Spazer.png\" title=\"Spazer.png\" class=\"width: 32px\"/> Spazer</li>\
<li><img src=\"/solver/static/images/Wave.png\" alt=\"Wave.png\" title=\"Wave.png\" class=\"width: 32px\"/> Wave Beam</li>\
</ul>\
Click on the dice button to randomly set this parameter.",
      placement: "auto left"
    },
    {
      element: "#funMovementStep",
      title: "Super Fun Movement",
      content: "<p>Forces removal of Space Jump <img src=\"/solver/static/images/SpaceJump.png\" alt=\"SpaceJump.png\" title=\"SpaceJump.png\" class=\"width: 32px\"/> if the preset allows it.<br/>\
In addition, can randomly remove some items from the Movement set:</p>\
<ul>\
<li><img src=\"/solver/static/images/HiJump.png\" alt=\"HiJump.png\" title=\"HiJump.png\" class=\"width: 32px\"/> Hi Jump</li>\
<li><img src=\"/solver/static/images/Grapple.png\" alt=\"Grapple.png\" title=\"Grapple.png\" class=\"width: 32px\"/> Grappling Beam</li>\
<li><img src=\"/solver/static/images/SpringBall.png\" alt=\"SpringBall.png\" title=\"SpringBall.png\" class=\"width: 32px\"/> Spring Ball</li>\
<li><img src=\"/solver/static/images/SpeedBooster.png\" alt=\"SpeedBooster.png\" title=\"SpeedBooster.png\" class=\"width: 32px\"/> Speed Booster</li>\
<li><img src=\"/solver/static/images/Bomb.png\" alt=\"Bomb.png\" title=\"Bomb.png\" class=\"width: 32px\"/> Bombs</li>\
</ul>\
Click on the dice button to randomly set this parameter.",
      placement: "auto left"
    },
    {
      element: "#funSuitsStep",
      title: "Suitless",
      content: "<p>If the preset and seed layout allow it, will force removal of at least one suit (Varia Suit <img src=\"/solver/static/images/Varia.png\" alt=\"Varia.png\" title=\"Varia.png\" class=\"width: 32px\"/> and/or Gravity Suit <img src=\"/solver/static/images/Gravity.png\" alt=\"Gravity.png\" title=\"Gravity.png\" class=\"width: 32px\"/>).</p>\
<p>Click on the dice button to randomly set this parameter.</p>",
      placement: "auto left"
    },
    {
      element: "#patchesStep",
      title: "Default Patches",
      content: "Patches also included by default:\
<ul>\
<li>Allows the aim buttons to be assigned to any button (by Kejardon)</li>\
<li>Max Ammo Display (by Personitis)</li>\
<li>Play music with MSU1 chip on SD2SNES (by DarkShock)</li>\
<li>Red Brinstar elevator door is blue (by Flo)</li>\
</ul>",
      placement: "auto left"
    },
    {
      element: "#layoutPatchesStep",
      title: "Anti-softlock Layout patches",
      content: "Include the anti-softlock layout patches. Disable at your own softlocking risk!\
<table class=\"full\">\
<tr>\
<td class=\"knowsUsed\"><p class=\"top\">Disable respawning blocks at Dachora Pit:</p></td>\
<td class=\"knowsUsed\"><p class=\"top\">Escape from below early Super bridge without Bombs:</p></td>\
<td class=\"knowsUsed\"><p class=\"top\">Escape from below early Super bridge:</p></td>\
<td class=\"knowsUsed\"><p class=\"top\">Replace bomb blocks with shot blocks before Hi-Jump:</p></td>\
</tr>\
<tr>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/dachora.png\" alt=\"dachora\" title=\"dachora\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/early_super.png\" alt=\"early_super\" title=\"early_super\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/early_super_bis.png\" alt=\"early_super_bis\" title=\"early_super_bis\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/high_jump.png\" alt=\"high_jump\" title=\"high_jump\" class=\"full\"/></td>\
</tr>\
<tr>\
<td class=\"knowsUsed\"><p class=\"top\">Replace bomb blocks with shot blocks at Moat:</p></td>\
<td class=\"knowsUsed\"><p class=\"top\">First heated Norfair room without High-Jump:</p></td>\
<td class=\"knowsUsed\"><p class=\"top\">Always be able to get back up from bottom Red Tower:</p></td>\
<td class=\"knowsUsed\"><p class=\"top\">Replace bomb blocks with shot blocks before Spazer:</p></td>\
</tr>\
<tr>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/moat.png\" alt=\"moat\" title=\"moat\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/cathedral.png\" alt=\"cathedral\" title=\"cathedral\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/red_tower.png\" alt=\"red_tower\" title=\"red_tower\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/spazer_block.png\" alt=\"spazer_block\" title=\"spazer_block\" class=\"full\"/></td>\
</tr>\
<tr>\
<td class=\"knowsUsed\"><p class=\"top\">Remove grey door at Brinstar map stations:</p></td>\
<td class=\"knowsUsed\"><p class=\"top\">Spore Spawn save station is always available:</p></td>\
<td class=\"knowsUsed\"><p class=\"top\">Replace bomb blocks with shot blocks before Kraid save:</p></td>\
<td class=\"knowsUsed\"><p class=\"top\">Replace bomb blocks with shot blocks at Pink Brinstar Power Bomb Room:</p></td>\
</tr>\
<tr>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/bt_map.png\" alt=\"bt_map\" title=\"bt_map\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/spore_save.png\" alt=\"spore_save\" title=\"spore_save\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/kraid_save.png\" alt=\"kraid_save\" title=\"kraid_save\" class=\"full\"/></td>\
<td class=\"knowsUsed\"><img src=\"/solver/static/images/mission_impossible.png\" alt=\"mission_impossible\" title=\"mission_impossible\" class=\"full\"/></td>\
</tr>\
</table>\
<p>Using a non-standard or randomized start location will force this setting on.</p>\
<p>Patches developed by Total & Flo.</p>",
      placement: "auto left"
    },
    {
      element: "#variaTweaksStep",
      title: "VARIA Tweaks",
      content: "<p>Include minor tweaks for the game to behave 'as it should' in a randomizer context:</p>\
<table class=\"full\">\
<tr>\
<td class=\"quarter\"><p class=\"top\">Bomb Torizo fight is triggered when picking up the item he's holding, not by having Bomb:</p></td>\
<td class=\"quarter\"><p class=\"top\">Access item at Wrecked Ship Etank location without killing Phantoon (via Forgotten Highway):</p></td>\
<td class=\"quarter\"><p class=\"top\">Activate Lower Norfair Chozo (left of entrance) without Space Jump:</p></td>\
</tr>\
<tr>\
<td class=\"quarter\"><img src=\"/solver/static/images/bomb_torizo.png\" alt=\"bomb_torizo\" title=\"bomb_torizo\" class=\"full\"/></td>\
<td class=\"quarter\"><img src=\"/solver/static/images/ws_etank.png\" alt=\"ws_etank\" title=\"ws_etank\" class=\"full\"/></td>\
<td class=\"quarter\"><img src=\"/solver/static/images/ln_chozo.png\" alt=\"ln_chozo\" title=\"ln_chozo\" class=\"full\"/></td>\
</tr>\
</table>\
<p>Using a non-standard or randomized start location will force this setting on.</p>\
<p>Patch developed by Flo.</p>",
      placement: "auto left"
    },
    {
      element: "#nerfedChargeStep",
      title: "Nerfed Charge Beam",
      content: "<ul>\
<li>Samus begins with a starter Charge Beam <img src=\"/solver/static/images/Charge.png\" alt=\"Charge.png\" title=\"Charge.png\" class=\"width: 32px\"/> that does one third of charged shot damage, effectively bringing a nerfed charge shot damage to a standard shot damage, but that can damage bosses.</li>\
<li><a href=\"https://wiki.supermetroid.run/Pseudo_Screw_Attack\" target=\"_blank\">Pseudo Screws</a> also do one third damage.</li>\
<li><a href=\"https://wiki.supermetroid.run/Charge_Beam_Combos\" target=\"_blank\">Special Beam Attacks</a> do normal damage but cost 3 Power Bombs instead of 1.</li>\
<li>Once the Charge Beam <img src=\"/solver/static/images/Charge.png\" alt=\"Charge.png\" title=\"Charge.png\" class=\"width: 32px\"/> item has been collected, it does full damage and special attacks are back to normal.</li>\
</ul>\
<p>Patch developed by Smiley and Flo.</p>",
      placement: "auto left"
    },
    {
      element: "#gravityBehaviourStep",
      title: "Suits Properties",
      content: "<p><ul>\
<li>Balanced:<p>Removes Gravity <img src=\"/solver/static/images/Gravity.png\" alt=\"Gravity.png\" title=\"Gravity.png\" class=\"width: 32px\"/> environmental protection (heat, spikes, electricity...). It also doubles the Varia <img src=\"/solver/static/images/Varia.png\" alt=\"Varia.png\" title=\"Varia.png\" class=\"width: 32px\"/> environmental protection, to balance the two suits abilities. Enemy damage protection is still vanilla (50% for Varia, 75% for Gravity).</p></li>\
<li>Progressive:\
<p><ul>\
<li>Gravity <img src=\"/solver/static/images/Gravity.png\" alt=\"Gravity.png\" title=\"Gravity.png\" class=\"width: 32px\"/> provides 50% heat damage reduction. Varia <img src=\"/solver/static/images/Varia.png\" alt=\"Varia.png\" title=\"Varia.png\" class=\"width: 32px\"/> still provides full heat protection.</li>\
<li>Varia <img src=\"/solver/static/images/Varia.png\" alt=\"Varia.png\" title=\"Varia.png\" class=\"width: 32px\"/> and Gravity  <img src=\"/solver/static/images/Gravity.png\" alt=\"Gravity.png\" title=\"Gravity.png\" class=\"width: 32px\"/> each add 50% damage reduction to enemy attacks and environmental damage.</li>\
<li>Varia <img src=\"/solver/static/images/Varia.png\" alt=\"Varia.png\" title=\"Varia.png\" class=\"width: 32px\"/> and Gravity  <img src=\"/solver/static/images/Gravity.png\" alt=\"Gravity.png\" title=\"Gravity.png\" class=\"width: 32px\"/> stack to reach 75% reduction to enemy attacks and environmental damage.</li>\
</ul></p>\
</li>\
<li>Vanilla:<p>No change to vanilla suits properties. Most notably, Gravity <img src=\"/solver/static/images/Gravity.png\" alt=\"Gravity.png\" title=\"Gravity.png\" class=\"width: 32px\"/> provides full protection against environmental damages (heat, spikes, electricity...).</p></li>\
</ul></p>\
<p>Patches developed by Total and Smiley.</p>",
      placement: "auto left"
    },
    {
      element: "#itemsoundsStep",
      title: "Fanfare",
      content: "<p>Replaces the quite long fanfare played when picking up an item by a short sound effect related with the item picked, and does not restart game music on item pickup.</p>\
<p>Patch developed by Scyzer.</p>",
      placement: "auto left"
    },
    {
      element: "#ElevatorDoorsStep",
      title: "Transitions",
      content: "<p>Accelerate doors and elevators transitions</p>\
<p>Doors patch developed by Rakki and elevators patch by Lioran.</p>",
      placement: "auto left"
    },
    {
      element: "#spinjumprestartStep",
      title: "Spin jump restart",
      content: "<p>Allows Samus to start spinning in mid air after jumping or falling</p>\
<p>Patch developed by Kejardon.</p>",
      placement: "auto left"
    },
    {
      element: "#rando_speedStep",
      title: "Momentum conservation",
      content: "<p>Let Samus keeps her momentum when landing from a fall or from jumping</p>\
<p>This patch was developed by Oi27.</p>",
      placement: "auto left"
    },
    {
      element: "#Infinite_Space_JumpStep",
      title: "Infinite Space Jump",
      content: "<p>Space jumps can be done quicker and at any time in air, water or lava, even after falling long distances.</p>\
<p>This patch was developed by MetConst.</p>",
      placement: "auto left"
    },
    {
      element: "#refill_before_saveStep",
      title: "Refill before save",
      content: "<p>Refill energy and ammo when saving.</p>\
<p>This patch was developed by Adam.</p>",
      placement: "auto left"
    },
    {
      element: "#animalsStep",
      title: "Animals surprise",
      content: "<p>Replace saving the animals in the escape sequence by a random surprise.<br/><b>Note:</b> This setting is not available when Escape Randomization is enabled, as it is replaced by Animals Challenges (see Escape Randomization help for more information).</p>\
<p>Patch developed by Foosda.</p>",
      placement: "auto left"
    },
    {
      element: "#No_MusicStep",
      title: "No music",
      content: "<p>Disable the background music to let you hear you favorite tunes instead.</p>\
<p>Patch developed by Kejardon.</p>",
      placement: "auto left"
    },
    {
      element: "#random_musicStep",
      title: "Random Music",
      content: "<p>Randomize the background music.</p>\
<p>Patch developed by dude & flo.</p>",
      placement: "auto left"
    }
 ]});

  // Initialize the tour
  tour.init();

  // Start the tour
  if(step != -1) {
    tour.goTo(step);
  }
  tour.start();
}

function DoPost(){
    $.redirect("/presets", { action: "Load", currenttab: "Techniques1", preset: document.getElementById("preset").value }, "POST", "_blank");
}
</script>
{{
def displayCheckbox(id, defaultTrue=False):
  if (id in session.randomizer and session.randomizer[id] == 'on') or (id not in session.randomizer and defaultTrue == True):
}}
    {{=INPUT(_id=id, _name=id, _type="checkbox", _checked="checked", _value="on", _class="js-switch", _onchange="switchCheckbox('{}')".format(id))}}
{{
  else:
}}
    {{=INPUT(_id=id, _name=id, _type="checkbox", _value="off", _class="js-switch", _onchange="switchCheckbox('{}')".format(id))}}
    {{pass}}
  {{pass}}

{{
def displaySelect(id, values, default):
  if id in session.randomizer:
    value = session.randomizer[id]
  else:
    value = default
    pass
}}
  {{
   =SELECT(*values,
           **dict(_id=id, _name=id, value=value, _class="full"))
  }}
{{pass}}

{{
def displayMultiSelect(id, selectedValues, default, multipleValues):
  displaySelect(id, multipleValues, default)

  response.write("<div id=\"{}MultiSelectDiv\" style=\"display:none\">".format(id), escape=False)
  response.write("<select id=\"{}MultiSelect\" class=\"filldropdown chzn-select\" multiple>".format(id), escape=False)
  for value in multipleValues:
    if value in selectedValues:
      response.write("  <option value=\"{}\" selected=\"selected\">{}</option>".format(value, value), escape=False)
    else:
      response.write("  <option value=\"{}\">{}</option>".format(value, value), escape=False)
      pass
    pass
  response.write("</select>", escape=False)
  response.write("</div>", escape=False)
  pass
}}

{{
def displayNumber(id, min, max, default, step="1"):
  if id in session.randomizer:
    value = session.randomizer[id]
  else:
    value = default
    pass

  response.write("<input name=\"{}\" id=\"{}\" type=\"number\" value=\"{}\" min=\"{}\" max=\"{}\" step=\"{}\" class=\"full\" required>".format(id, id, value, min, max, step), escape=False)
  pass
}}
<body>
  <div id="overlay"></div>
  <div id="loadingGIF"><img src={{=URL('static/images','ajax-loader.gif')}}/></div>
  <div id="loadingTips0" class="loadingTips"></div>
  <div id="loadingTips1" class="loadingTips"></div>

  <div class="fixed">
    <div class="menu">
    <table class="full menuTable">
      <tr>
        <td>{{=A("Home", _href=URL(f="home"), _class="menu")}}</td>
        <td>{{=A("Presets", _href=URL(f="presets"), _class="menu")}}</td>
        <td class="menu_selected">{{=A("Randomizer", _href=URL(f="randomizer"), _class="menu")}}</td>
        <td>{{=A("Solver", _href=URL(f="solver"), _class="menu")}}</td>
        <td>{{=A("Tracker", _href=URL(f="tracker"), _class="menu")}}</td>
        <td>{{=A("Plandomizer", _href=URL(f="plando"), _class="menu")}}</td>
        <td>{{=A("Plandository", _href=URL(f="plandorepo"), _class="menu")}}</td>
        <td>{{=A("Customizer", _href=URL(f="customizer"), _class="menu")}}</td>
        <td>{{=A("Statistics", _href=URL(f="extStats"), _class="menu")}}</td>
        <td>{{=A("Information & Contact", _href=URL(f="infos"), _class="menu")}}</td>
      </tr>
    </table>
    </div>
  </div>

  <div class="main">
    <div id="complexityTabs" class="center">
      <div class="tab">
        <button class="tablinks" id="simple" onclick="changeComplexity(event, 'simple');">Simple</button>
        <button class="tablinks" id="medium" onclick="changeComplexity(event, 'medium');">Medium</button>
        <button class="tablinks" id="advanced" onclick="changeComplexity(event, 'advanced');">Advanced</button>
      </div>
    </div>
    <form id="mainform" name="mainform" onsubmit="doSubmit(); return false;">
      <div id="tabRando" class="tabcontent">
        <div class="row">
          <div class="column">
            <p>The Very Adaptive Randomizer of Items and Area (VARIA) randomizer will generate a Super Metroid ROM finishable using the known techniques of the chosen preset.</p>
            <table class="full">
              <colgroup><col class="half" /><col class="half" /></colgroup>
              <tr>
              <td>Last generated seed permalink:</td><td><span id="permalink"></span></td><td id="permalinkStep"><button type="button" onclick="startTheTour(0)">?</button></td>
              </tr>
              <tr>
                <td>Vanilla Super Metroid ROM:</td>
                <td>
                   <div id="uploadFileVisibility">
                     {{=INPUT(_type="file", _name="uploadFile", _id="uploadFile", _class="full")}}
                   </div>
                   <div id="uploadFileOKVisibility">
                     Vanilla ROM already loaded
                   </div>
                </td>
                <td id="romStep"><button type="button" onclick="startTheTour(1)">?</button></td>
              </tr>
              <tr id="seedVisibility">
                <td>Randomizer seed:</td>
                <td>{{displayNumber("seed", "0", maxsize, "0")}}</td>
                <td id="seedStep"><button type="button" onclick="startTheTour(2)">?</button></td>
              </tr>
              <tr>
                <td>Skills Preset: <span class="rightStep"><a href="javascript:DoPost()">What's in the logic for this skills preset ?</a><span></td><!-- ' -->
                <td>{{=SELECT(OPTGROUP(*stdPresets, **dict(_label="Standard presets")), OPTGROUP(*tourPresets, **dict(_label="Tournament presets")), OPTGROUP(*comPresets, **dict(_label="Community presets")), **dict(_name="preset", _id="preset", value=session.randomizer["preset"], _class="filldropdown chzn-select"))}}</td>
                <td id="presetStep"><button type="button" onclick="startTheTour(3)">?</button></td>
              </tr>
              <tr>
                <td>Settings Preset:</td>
                <td>
                  <select class="filldropdown chzn-select" id="randoPreset" name="randoPreset" onchange="loadRandoPreset()">
                    <optgroup label="Standard presets">
{{
  for preset in randoPresets:
    if preset == "":
      response.write('<option selected="selected" value="{}">{}</option>\\\n'.format(preset, preset), escape=False)
    else:
      response.write('<option value="{}">{}: {}</option>\\\n'.format(preset, preset, randoPresetsDesc.get(preset, "")), escape=False)
      pass
    pass
}}
                    </optgroup>
                    <optgroup label="Tournament presets">
{{
  for preset in tourRandoPresets:
    response.write('<option value="{}">{}: {}</option>\\\n'.format(preset, preset, randoPresetsDesc.get(preset, "")), escape=False)
    pass
}}
                </optgroup>
                </select>
                </td>
                <td id="randoPresetStep"><button type="button" onclick="startTheTour(4)">?</button></td>
              </tr>
              <tr id="raceModeVisibility">
                <td>{{displayCheckbox("raceMode")}}<span id="raceModeText">Race Mode</span></td>
                <td></td>
                <td id="raceStep"><button type="button" onclick="startTheTour(5)">?</button></td>
              </tr>
            </table>
            <br/>
            <h4>Randomizer parameters</h4>
            <table class="full">
              <tr>
                <td class="small"><div class="random"><button id="startLocationRandom" type="button" onclick="randomize(event, 'startLocation')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td><span id="startLocationText">Start location</span></td>
                <td>{{displayMultiSelect("startLocation", currentMultiValues["startLocation"], "Landing Site", defaultMultiValues["startLocation"])}}</td>
                <td id="StartLocationStep"><button type="button" onclick="startTheTour(6)">?</button></td>
              </tr>
              <tr>
                <td class="small"><div class="random"><button id="majorsSplitRandom" type="button" onclick="randomize(event, 'majorsSplit')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td><span id="majorsSplitText">Majors Split</span></td>
                <td>{{displayMultiSelect("majorsSplit", currentMultiValues["majorsSplit"], "Full", defaultMultiValues["majorsSplit"])}}</td>
                <td id="majorsSplitStep"><button type="button" onclick="startTheTour(7)">?</button></td>
              </tr>
              <tr id="maxDiffVisibility">
                <td class="small"></td>
                <td><span id="maxDifficultyText">Maximum difficulty for picking up an item:</span></td>
                <td>{{displaySelect("maxDifficulty", ['no difficulty cap', 'easy', 'medium', 'hard', 'harder', 'hardcore', 'mania'], "hardcore")}}</td>
                <td id="maxDifficultyStep"><button type="button" onclick="startTheTour(8)">?</button></td>
              </tr>
              <tr>
                <td class="small"><div class="random"><button id="progressionSpeedRandom" type="button" onclick="randomize(event, 'progressionSpeed')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td class="half"><span id="progressionSpeedText">Progression speed:</span></td>
                <td class="half">
                  {{displayMultiSelect("progressionSpeed", currentMultiValues["progressionSpeed"], "medium", defaultMultiValues["progressionSpeed"])}}
                </td>
                <td id="progSpeedStep"><button type="button" onclick="startTheTour(9)">?</button></td>
              </tr>
              <tr id="progDiffVisibility">
                <td class="small"><div class="random"><button id="progressionDifficultyRandom" type="button" onclick="randomize(event, 'progressionDifficulty')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td class="half"><span id="progressionDifficultyText">Progression difficulty:</span></td>
                <td class="half">{{displayMultiSelect("progressionDifficulty", currentMultiValues["progressionDifficulty"], "normal", defaultMultiValues["progressionDifficulty"])}}</td>
                <td id="progDiffStep"><button type="button" onclick="startTheTour(10)">?</button></td>
              </tr>
              <tr id="morphPlacementVisibility">
                <td class="small"><div class="random"><button id="morphPlacementRandom" type="button" onclick="randomize(event, 'morphPlacement')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td class="half"><span id="morphPlacementText">Morph Placement:</span></td>
                <td class="half">{{displayMultiSelect("morphPlacement", currentMultiValues["morphPlacement"], "normal", defaultMultiValues["morphPlacement"])}}</td>
                <td id="morphPlacementStep"><button type="button" onclick="startTheTour(11)">?</button></td>
              </tr>
              <tr id="suitsRestrictionVisibility">
                <td class="small"><div class="random"><button id="suitsRestrictionRandom" type="button" onclick="randomize(event, 'suitsRestriction')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td colspan="2">{{displayCheckbox("suitsRestriction")}}<span id="suitsRestrictionText">Suits restriction</span></td>
                <td id="suitsRestrictionStep"><button type="button" onclick="startTheTour(12)">?</button></td>
              </tr>
              <tr id="hideItemsVisibility">
                <td class="small"><div class="random"><button id="hideItemsRandom" type="button" onclick="randomize(event, 'hideItems')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td colspan="2">{{displayCheckbox("hideItems")}}<span id="hideItemsText">Hide some items</span></td>
                <td id="hideItemsStep"><button type="button" onclick="startTheTour(13)">?</button></td>
              </tr>
            </table>
            <div id="ammoVisibility">
              <h4>Ammo and Energy</h4>
              <table class="full">
                <colgroup><col class="small"/><col class="half" /><col class="half" /><col class="small"/></colgroup>
                <tr id="strictMinorsVisibility">
                  <td class="small"><div class="random"><button id="strictMinorsRandom" type="button" onclick="randomize(event, 'strictMinors')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td colspan="2">{{displayCheckbox("strictMinors")}}<span id="strictMinorsText">Strict Minors distribution</span></td>
                  <td id="strictMinorsStep"><button type="button" onclick="startTheTour(14)">?</button></td>
                </tr>
                <tr id="missileQtyVisibility">
                  <td class="small"><div class="random"><button id="missileQtyRandom" type="button" onclick="randomize(event, 'missileQty')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td><span id="missileQtyText">Proportion of Missiles:</span></td>
                  <td>{{displayNumber("missileQty", "1", "9", "3", "0.1")}}</td>
                  <td id="missileQtyStep"><button type="button" onclick="startTheTour(15)">?</button></td>
                </tr>
                <tr id="superQtyVisibility">
                  <td class="small"><div class="random"><button id="superQtyRandom" type="button" onclick="randomize(event, 'superQty')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td><span id="superQtyText">Proportion of Super Missiles:</span></td>
                  <td>{{displayNumber("superQty", "1", "9", "3", "0.1")}}</td>
                </tr>
                <tr id="powerBombQtyVisibility">
                  <td class="small"><div class="random"><button id="powerBombQtyRandom" type="button" onclick="randomize(event, 'powerBombQty')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td><span id="powerBombQtyText">Proportion of Power Bombs:</span></td>
                  <td>{{displayNumber("powerBombQty", "1", "9", "1", "0.1")}}</td>
                </tr>
                <tr>
                  <td class="small"><div class="random"><button id="minorQtyRandom" type="button" onclick="randomize(event, 'minorQty')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td><span id="minorQtyText">Percentage of minors available:</span></td>
                  <td>{{displayNumber("minorQty", "7", "100", "100")}}</td>
                  <td id="minorQtyStep"><button type="button" onclick="startTheTour(16)">?</button></td>
                </tr>
                <tr>
                  <td class="small"><div class="random"><button id="energyQtyRandom" type="button" onclick="randomize(event, 'energyQty')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td><span id="energyQtyText">Quantity of Energy/Reserve Tanks available:</span></td>
                  <td>{{displayMultiSelect("energyQty", currentMultiValues["energyQty"], "vanilla", defaultMultiValues["energyQty"])}}</td>
                  <td id="energyQtyStep"><button type="button" onclick="startTheTour(17)">?</button></td>
                </tr>
              </table>
            </div>
          </div>
          <div class="column">
            <h4>Areas Randomization</h4>
            <p>
              Add more randomness to your seed by randomizing the access between the areas.<br/>
              Check the help button for the map of the areas and the access points between them.
            </p>
            <table class="full">
              <tr>
                <td class="small"><div class="random"><button id="areaRandomizationRandom" type="button" onclick="randomize(event, 'areaRandomization')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td class="half" id="areaRandomizationStep">{{displayCheckbox("areaRandomization")}}<span id="areaRandomizationText">Areas randomization</span></td>
                <td><button type="button" onclick="startTheTour(18)">?</button></td>
                <td class="full" id="lightAreaRandomizationStep">{{displayCheckbox("lightAreaRandomization")}}<span id="lightAreaRandomizationText">Light Areas randomization</span></td>
                <td><button type="button" onclick="startTheTour(19)">?</button></td>
              </tr>
            </table>
            <table id="areaLayoutVisibility" class="full">
              <colgroup><col class="half" /><col class="half" /></colgroup>
              <tr>
                <td colspan="2" id="areaLayoutStep">{{displayCheckbox("areaLayout", False)}}<span id="areaLayoutText">Additional layout patches for easier navigation</span></td>
                <td><button type="button" onclick="startTheTour(20)">?</button></td>
              </tr>
            </table>

            <h4>Doors Colors Randomization</h4>
            <table class="full">
              <tr>
                <td class="small"><div class="random"><button id="doorsColorsRandoRandom" type="button" onclick="randomize(event, 'doorsColorsRando')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td class="half" id="doorsColorsRandoStep">{{displayCheckbox("doorsColorsRando")}}<span id="doorsColorsRandoText">Randomize the color of Red/Green/Yellow doors</span></td>
                <td><button type="button" onclick="startTheTour(21)">?</button></td>
                <td class="half" id="doorsColorsGreyStep">{{displayCheckbox("allowGreyDoors")}}Allow some doors to be randomized to grey doors</td>
                <td><button type="button" onclick="startTheTour(22)">?</button></td>
              </tr>
            </table>
            <h4>Bosses Randomization</h4>
            <p>
              Randomize the access doors to the Golden 4 bosses.
            </p>
            <table class="full">
              <tr>
                <td class="small"><div class="random"><button id="bossRandomizationRandom" type="button" onclick="randomize(event, 'bossRandomization')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td colspan="4" class="full" id="bossRandomizationStep">{{displayCheckbox("bossRandomization")}}<span id="bossRandomizationText">Bosses randomization</span></td>
                <td><button type="button" onclick="startTheTour(23)">?</button></td>
              </tr>
              <tr>
                <td class="small"><div class="random"><button id="minimizerQtyRandom" type="button" onclick="randomizeMinimizer(event)" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                <td id="minimizerStep" class="third">{{displayCheckbox("minimizer")}}<span id="minimizerText">Boss rush, aka Minimizer</span></td>
                <td class="sixth"><span id="minimizerQtyText">Number of locations:</span></td>
                <td class="sixth">{{displayNumber("minimizerQty", "30", "100", "45", "1")}}</td>
                <td class="third paddingonleft">{{displayCheckbox("minimizerTourian")}}<span id="minimizerTourianText">Speed up Tourian</span></td>
                <td><button type="button" onclick="startTheTour(24)">?</button></td>
              </tr>
            </table>
            <div id="escapeRandoVisibility">
              <h4>Escape Randomization</h4>
              <table class="full">
                <tr>
                  <td class="small"><div class="random"><button id="escapeRandoRandom" type="button" onclick="randomize(event, 'escapeRando')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td class="half" id="escapeRandoStep">{{displayCheckbox("escapeRando", False)}}<span id="escapeRandoText">Randomize the escape sequence</span></td>
                  <td><button type="button" onclick="startTheTour(25)">?</button></td>
                  <td class="half" id="removeEscapeEnemiesStep">{{displayCheckbox("removeEscapeEnemies", False)}}<span id="removeEscapeEnemiesText">Remove enemies during randomized escape sequence</span></td>
                  <td><button type="button" onclick="startTheTour(26)">?</button></td>
                </tr>
              </table>
            </div>
            <div id="superFunVisibility">
              <h4>Super Fun Times&trade;</h4>
              <p>
                Have fun randomly removing major items!
              </p>
              <table class="full">
                <tr>
                  <td class="small" id="funCombatStep"><div class="random"><button id="funCombatRandom" type="button" onclick="randomize(event, 'funCombat')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td class="third">{{displayCheckbox("funCombat")}}<span id="funCombatText">Super Fun Combat</span></td>
                  <td><button type="button" onclick="startTheTour(27)">?</button></td>

                  <td class="small" id="funMovementStep"><div class="random"><button id="funMovementRandom" type="button" onclick="randomize(event, 'funMovement')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td class="third">{{displayCheckbox("funMovement")}}<span id="funMovementText">Super Fun Movement</span></td>
                  <td><button type="button" onclick="startTheTour(28)">?</button></td>

                  <td class="small" id="funSuitsStep"><div class="random"><button id="funSuitsRandom" type="button" onclick="randomize(event, 'funSuits')" class="small"><span class="small dice_rotate">&#x2684;</span></button></div></td>
                  <td class="third">{{displayCheckbox("funSuits")}}<span id="funSuitsText">Suitless</span></td>
                  <td><button type="button" onclick="startTheTour(29)">?</button></td>
                </tr>
              </table>
            </div>
            <div id="noPatchesVisibility">
              <h4>Patches</h4>
              <p>Some patches are applied by default, use the 'advanced' tab to see them.</p>
            </div>
            <div id="patchesVisibility">
              <h4 id="patchesStep">Patches<span class="rightStep"><button type="button" onclick="startTheTour(30)">?</button></span></h4>
              <p id="mainPatchesTextVisibility">
                The bug fix <a href="https://itemrando.supermetroid.run/information" target="_blank">patches</a> from Total Item Randomizer are included by default.
              </p>
              <table class="full">
                <colgroup><col class="quarter" /><col class="threequarter" /><col class="check" /></colgroup>
                <tr><td colspan="2"><h5 class="center"><b>Randomizer adaptations (logic impact)</b></h5></td><td></td></tr>
              </table>
              <table class="full" id="mainPatchesVisibility">
                <tr>
                  <td id="layoutPatchesStep" class="half">{{displayCheckbox("layoutPatches", True)}} Anti-softlock layout patches</td>
                  <td><button type="button" onclick="startTheTour(31)">?</button></td>
                  <td id="variaTweaksStep" class="half">{{displayCheckbox("variaTweaks", True)}} VARIA tweaks</td>
                  <td><button type="button" onclick="startTheTour(32)">?</button></td>
                </tr>
              </table>
              <table class="full" id="nerfedChargeVisibility">
                <colgroup><col class="half" /><col class="half" /></colgroup>
                <tr id="nerfedChargeStep">
                  <td colspan="2">
                    {{displayCheckbox("nerfedCharge")}}
                    Nerfed Charge Beam available from the start
                  </td>
                  <td><button type="button" onclick="startTheTour(33)">?</button></td>
                </tr>
              </table>
              <table class="full" id="gravityBehaviourVisibility">
                <tr id="gravityBehaviourStep">
                  <td class="half">Suits properties</td>
                  <td class="half">
                    {{displaySelect("gravityBehaviour", ["Balanced", "Progressive", "Vanilla"], "Balanced")}}
                  </td>
                  <td><button type="button" onclick="startTheTour(34)">?</button></td>
                </tr>
              </table>
              <table class="full">
                <colgroup><col class="quarter" /><col class="threequarter" /><col class="check" /></colgroup>
                <tr><td colspan="2"><h5 class="center"><b>Game comfort</b></h5></td><td></td></tr>
              </table>
              <table class="full">
                <tr>
                  <td id="itemsoundsStep" class="half">
                    {{displayCheckbox("itemsounds")}}
                    Remove fanfare when picking up an item
                  </td>
                  <td><button type="button" onclick="startTheTour(35)">?</button></td>
                  <td id="ElevatorDoorsStep" class="half">
                    {{displayCheckbox("elevators_doors_speed")}}
                    Accelerate doors and elevators transitions
                  </td>
                  <td><button type="button" onclick="startTheTour(36)">?</button></td>
                </tr>
              </table>
              <table class="full">
                <tr>
                  <td id="spinjumprestartStep" class="half">
                    {{displayCheckbox("spinjumprestart")}}
                    Spin jump restart (a.k.a. Respin)
                  </td>
                  <td><button type="button" onclick="startTheTour(37)">?</button></td>
                  <td id="rando_speedStep" class="half">
                    {{displayCheckbox("rando_speed")}}
                     Momentum conservation (a.k.a. Speedkeep)
                  </td>
                  <td><button type="button" onclick="startTheTour(38)">?</button></td>
                </tr>
              </table>
              <table class="full" id="helperPatchesVisibility">
                <tr>
                  <td id="Infinite_Space_JumpStep" class="half">
                    {{displayCheckbox("Infinite_Space_Jump")}}
                    Infinite Space Jump
                  </td>
                  <td><button type="button" onclick="startTheTour(39)">?</button></td>
                  <td id="refill_before_saveStep" class="half">
                    {{displayCheckbox("refill_before_save")}}
                     Refill energy and ammo when saving
                  </td>
                  <td><button type="button" onclick="startTheTour(40)">?</button></td>
                </tr>
              </table>
              <table class="full">
                <colgroup><col class="quarter" /><col class="threequarter" /><col class="check" /></colgroup>
                <tr><td colspan="2"><h5 class="center"><b>Miscellaneous</b></h5></td><td></td></tr>
              </table>
              <table class="full" id="miscVisibility">
                <colgroup><col class="half" /><col class="half" /></colgroup>
                <tr id="animalsStep">
                  <td colspan="2">
                    {{displayCheckbox("animals")}}
                    <span id="animalsText">Save the animals surprise</span>
                  </td>
                  <td><button type="button" onclick="startTheTour(41)">?</button></td>
                </tr>
              </table>
              <table class="full" id="musicVisibility">
                <tr>
                  <td id="No_MusicStep" class="half">
                    {{displayCheckbox("No_Music")}}
                    Disable background music
                  </td>
                  <td><button type="button" onclick="startTheTour(42)">?</button></td>
                  <td id="random_musicStep" class="half">
                    {{displayCheckbox("random_music")}}
                    Randomize background music
                  </td>
                  <td><button type="button" onclick="startTheTour(43)">?</button></td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <p class="customizerText">
          <a href="/customizer" target="_blank">You can randomize in-game colors and use a custom Samus sprite on the Customizer page</a>.
        </p>
        {{=INPUT(_type="submit", _value="Randomize", _id="submitBtn", _class="btn btn-default buttonRandom")}}
    </form>
    <div class="donate">
      <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
        <input type="hidden" name="cmd" value="_s-xclick" />
        <input type="hidden" name="hosted_button_id" value="J6BEK8K8LVG7Y" />
        <input class="leagueImg" type="image" src="/solver/static/images/donate_randomizer.png" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
        <img alt="" border="0" src="https://www.paypal.com/en_FR/i/scr/pixel.gif" width="1" height="1" />
      </form>
    </div>
  </div>
</body>
